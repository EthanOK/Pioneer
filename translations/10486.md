
>- 原文链接：[report.helius.dev/](https://report.helius.dev/)
>- 译者：[AI翻译官](https://learnblockchain.cn/people/19584)，校对：[翻译小组](https://learnblockchain.cn/people/412)
>- 本文链接：[learnblockchain.cn/article…](https://learnblockchain.cn/article/10486)
    
![](https://img.learnblockchain.cn/attachments/migrate/1735874599682)

* * *

### 章节

*   [1\. 介绍](#chapter1)
*   [2\. 用户](#chapter2)
*   [3\. 墨西哥湾流](#chapter3)
*   [4\. 区块构建](#chapter4)
*   [5\. 历史证明](#chapter5)
*   [6\. 账户模型](#chapter6)
*   [7\. 涡轮](#chapter7)
*   [8\. 共识](#chapter8)
*   [9\. 谣言与归档](#chapter9)
*   [10\. 经济学与 Jito](#chapter10)

* * *

### 作者的说明

本文档旨在提供对核心 Solana 协议的全面概述，平衡可访问性和深度。也就是说，本报告旨在提供一个不假设广泛行业知识的资源，同时也不回避 Solana 协议的复杂性。这是说起来容易做起来难的事情！我希望这项工作能成为与加密相关的行业中广泛专业人士的宝贵参考，例如支付、金融和电子商务等领域，Solana 现在正出现在他们的视野中。虽然 Solana 确实比传统区块链更复杂，但绝不是不可理解的，正如本报告所旨在展示的那样。衷心感谢 [0xIchigo](https://x.com/0xIchigo)、[dubbelosix](https://x.com/dubbel06)、[Jacob Creech](https://x.com/jacobvcreech)、[Maël Bomane](https://x.com/mael_bomane)、Nagaprasad Vr 和 [Rex St. John](https://x.com/rexstjohn) 阅读本报告的早期版本并提供宝贵反馈。[Jack Sturt](https://x.com/sturt_jack) 为 [SolDic](https://soldic.xyz/) 的注释提供支持。最后，我要感谢 Jeff ([@japarjam](https://x.com/japarjam)) 和 [Mert](https://x.com/0xMert_) 在将这个项目整合在一起时的支持和指导。Lostin  
Solana 爱好者  
Helius 技术作家

*   [XX](https://x.com/__lostin__)
*   [GlobeGlobe](https://lostintime.work/)

* * *

*   [下载下载完整报告](https://drive.google.com/file/d/1puEThjO9rmnZmIj_05WvU99FPmUiZ4pb/view?usp=sharing)

![](https://img.learnblockchain.cn/attachments/migrate/1735874600068)

* * *

![](https://img.learnblockchain.cn/attachments/migrate/1735874600085)

![](https://img.learnblockchain.cn/attachments/migrate/1735874600123)

* * *

*“我们比世界上任何人都更了解更小、更快、更便宜的东西，现在我们将这些概念应用于区块链。”*— *Greg Fitzgerald，Solana 联合创始人*

* * *

Solana 是一个高性能、低延迟的区块链，以其速度、效率和用户体验而闻名。其独特的集成架构使得在全球去中心化网络中每秒可以处理数千笔交易。凭借 400 毫秒的区块时间和几分之一美分的交易费用，它在速度和成本效益上都表现出色。本报告深入探讨了 Solana 的设计和操作的复杂性，探索了其能力的关键机制和网络拓扑。Solana 采取了一种集成的方法来进行区块链开发，利用创始团队在构建分布式系统方面的数十年经验。Solana 的核心原则之一是软件永远不应妨碍硬件。这意味着软件充分利用其运行的硬件，并与之扩展。作为一个单链区块链，所有操作都在一个地方进行，基于此构建的所有应用程序都继承了可组合性，允许它们相互交互并建立在彼此之上。这种架构还确保了用户体验的简单直观，无需桥接、单独的链 ID 或流动性碎片化。

![](https://img.learnblockchain.cn/attachments/migrate/1735874600371)

Solana 正在迅速发展，最近的进展包括 SVM Rollups 和 [ZK Compression](https://www.zkcompression.com/) 作为重要的扩展解决方案。虽然这些项目可能有一天会影响我们对 Solana 的未来看法，但它们目前仍处于开发或采用的早期阶段，因此本报告将不予涵盖。

* * *

### 交易生命周期

我们理解 Solana 的主要视角将是典型交易的生命周期。为了构建一个最基本的模型来理解 Solana 交易，我们可以将过程概述如下：

![](https://img.learnblockchain.cn/attachments/migrate/1735874600385)

\- 用户发起交易，所有交易都发送到当前的主区块生产者（称为领导者）。领导者将这些交易编译成一个区块，执行它们，从而更新区块链的状态。\- 该交易区块随后在网络中传播，以便其他验证者执行和确认。本报告的后续部分将扩展此模型，并更详细地探讨此过程，从关键参与者——用户开始。

对核心 Solana 协议的重大更改需要经过正式、透明的 [流程](https://github.com/solana-foundation/solana-improvement-documents/blob/main/proposals/0001-simd-process.md)，提交 Solana 改进文档（SIMD），社区成员和核心工程师将对此进行公开评议。然后，网络将对 SIMD 进行投票。

* * *

### 六个阶段

![](https://img.learnblockchain.cn/attachments/migrate/1735874600428)

我们将在本报告中引用上面显示的六个阶段的视觉图，因为它为我们理解 Solana 核心元素之间的关系提供了一致的框架。前面的章节根据这六个阶段进行排列。最后几章——谣言、归档、经济学和 Jito——将解决任何未解的问题。需要注意的是，有些章节将跨越多个阶段，而有些阶段将在多个章节中出现。这种重叠是不可避免的，因为六个阶段的框架有其局限性。实际上，Solana 是一个复杂的分布式系统，具有许多相互依赖的元素。

* * *

*   [下载下载完整报告](https://drive.google.com/file/d/1puEThjO9rmnZmIj_05WvU99FPmUiZ4pb/view?usp=sharing)

* * *

*   [返回顶部](#top)

* * *

![](https://img.learnblockchain.cn/attachments/migrate/1735874600422)

* * *

*“Solana 有潜力成为加密界的苹果”*— *Raj Gokal，Solana 联合创始人*

* * *

用户的旅程通常始于设置和资助一个钱包应用程序。Solana 有多种流行的钱包应用程序可供选择，既有原生移动应用程序，也有浏览器扩展。钱包以加密方式生成用户密钥对，包括公钥和私钥。公钥作为其账户的唯一标识符，所有网络参与者都知道。用户在 Solana 上的账户可以视为一个数据结构，保存与其与 Solana 区块链交互相关的信息和状态。这样，公钥类似于文件名：就像文件名唯一标识文件在文件系统中的位置一样，Solana 公钥唯一标识 Solana 区块链上的账户。Solana 上的公钥表示为 32 字节的 Base58 编码字符串。例如：FDKJvWcJNe6wecbgDYDFPCfgs14aJnVsUfWQRYWLn4TnA 私钥——也称为秘密密钥——可以视为密码或访问密钥，授予访问和修改账户的权限。使用私钥签名是区块链处理授权的方式。知道私钥就拥有对账户的绝对控制权。Solana 私钥的长度也为 32 字节。密钥对是公钥（前半部分）和私钥（后半部分）的 64 字节组合。示例：3j15jr41S9KmdfughusutvvqBjAeEDbU5sDQp8EbwQ3Hify2pfM1hiEsuFFAVq8bwGywnZpswrbDzPENbBZbd5nj\[63,107,47,255,141,135,58,142,191,245,78,18,90,162,107,197,8,33,211,15,228,235,250,30,185,122,105,23,147,115,115,86,8,155,67,155,110,51,117,0,19,150,143,217,132,205,122,91,167,61,6,246,107,39,51,110,185,81,13,81,16,182,30,71\]私钥也可以从助记种子短语中派生，通常为 12 或 24 个单词。这种格式通常被钱包用于更方便的备份和恢复。可以从单个种子短语确定性地派生多个密钥。Solana 使用 [Ed25519](https://en.wikipedia.org/wiki/EdDSA#Ed25519) 作为其公钥密码学需求的广泛使用的椭圆曲线数字签名算法。Ed25519 因其小的密钥大小、小的签名大小、快速计算和对许多常见攻击的免疫性而受到青睐。每个 Solana 钱包地址代表 Ed25519 椭圆曲线上的一个点。

![](https://img.learnblockchain.cn/attachments/migrate/1735874600520)

用户使用他们的私钥签署交易。该签名包含在交易数据中，可以通过发件人的公钥由其他参与者进行验证。这个过程确保了交易未被篡改，并且是由对应私钥的所有者授权的。签名还充当交易的唯一标识符。

* * *

### Solana 交易

发送交易是更改 Solana 状态的唯一方式。任何写操作都是通过交易进行的，交易是原子的——要么交易尝试做的所有事情都发生，要么交易失败。交易，正式称为“交易消息”，包括四个部分：头部、账户地址列表、最近的区块哈希和指令。

![](https://img.learnblockchain.cn/attachments/migrate/1735874600659)

账户地址：此列表包含交易过程中将读取或写入的所有账户。在每个交易中构建这样的列表是 Solana 特有的要求，对开发者可能会造成挑战。然而，提前知道交易将与哪些状态交互，能够实现许多其他区块链上无法进行的优化。头部：头部包含对账户地址列表的引用，指示哪些账户必须签署交易。最近的区块哈希：用于防止重复和过时的交易。最近的区块哈希在 151 个区块后过期（大约 1 分钟）。默认情况下，RPC 会每 2 秒尝试转发交易，直到交易被最终确认或最近的区块哈希过期，此时交易将被丢弃。指令：这些构成了交易的核心部分。每个指令代表一个特定的操作（例如，转账、铸造、销毁、创建账户、关闭账户）。每个指令指定要执行的程序、所需的账户以及执行指令所需的数据。交易中的指令数量在一定程度上受限于其大小，最大为 1,232 字节。还有对可引用账户数量的限制。最后，还有对交易复杂度的限制，以计算单位（CU）为单位来衡量。CU 量化了处理交易所需的计算资源。

SOL 的最小单位称为“lamport”，等于一个 SOL 的十亿分之一，类似于比特币中的聪。lamport 以 [Leslie Lamport](https://en.wikipedia.org/wiki/Leslie_Lamport) 的名字命名，他是一位计算机科学家和数学家，其研究奠定了现代分布式系统的许多理论基础。

执行交易所需的 SOL 成本分为两部分——基础费用和优先费用。基础费用是固定的，每个签名成本为 5000 lamports，不管交易的复杂性如何——通常每个交易有 1 个签名。优先费用在技术上是可选的，但在区块空间需求高峰期间变得必不可少。这些费用以微 lamport（lamport 的百万分之一）每计算单位定价。其目的是作为价格信号，使交易在经济上更具吸引力，从而更容易被验证节点包含在其区块中。

总费用 = 优先费用 + 基础费用
优先费用 = 计算单位价格（微 lamports） x 计算单位限制

目前，所有与交易相关的费用的 50%被销毁，永久性地将这些 SOL 从流通中移除，剩余的 50%归区块生产者所有。即将推出的新变更（SIMD 96）将允许 100%的优先费用归区块生产者所有。基础费用保持不变。

![](https://img.learnblockchain.cn/attachments/migrate/1735874600853)

用户将他们的钱包连接到应用程序，允许应用程序读取用户的公钥。私钥仍然在与应用程序分开的安全环境中加密和封装。应用程序根据用户的交互构建交易消息参数。例如，如果用户希望交换两个代币，他们将指定要购买的代币数量、对应的出售代币以及可接受的交易滑点。一旦交易消息准备就绪，就会发送到钱包以使用用户的私钥进行签名。此时，用户会弹出提示以确认他们的交易意愿。此弹出窗口可能包含交易结果的模拟。一旦签名，交易消息和签名将返回给应用程序，应用程序可以将交易转发给其选择的 RPC 提供者，无论是他们自己的还是使用钱包提供者的。RPC（远程过程调用）提供者充当应用程序与构建区块的验证者之间的中介。他们是一个关键服务，使应用程序能够 [提交](https://github.com/solana-labs/solana/blob/cd6f931223181d5a1d47cba64e857785a175a760/rpc/src/rpc.rs#L3396) 或模拟签名的交易，并高效地检索链上数据。希望与网络交互的应用程序通过 JSON-RPC 或 WebSocket [端点](https://solana.com/docs/rpc) 进行交互。

“失败的交易”这一术语在 Solana 中具有误导性，造成了相当大的混淆。这些交易会产生费用，并且被运行时成功执行，正如签名者所意图的那样。它们之所以“失败”，是由于交易自身的逻辑要求它们如此。+80%的“失败”交易来自错误代码 0x1771，这是超出滑点金额的代码（ [数据](https://flipsidecrypto.xyz/zapokorny/q/18zuYlugBdcm/solana-failed-txs-by-program) ）。值得注意的是，95%的这些交易仅由 0.1%的活跃 Solana 地址提交，主要是自动化机器人尝试利用时限敏感的价格套利机会。

* * *

*   [下载完整报告](https://drive.google.com/file/d/1puEThjO9rmnZmIj_05WvU99FPmUiZ4pb/view?usp=sharing)

* * *

*   [回到顶部](#top)

* * *

![](https://img.learnblockchain.cn/attachments/migrate/1735874600727)

* * *

*“Solana 的目标就是以快如新闻传播的速度进行交易——通过光纤传播的光速。我们正在与纳斯达克和纽约证券交易所竞争。”* — *Anatoly Yakovenko, Solana 联合创始人*

* * *

RPC（远程过程调用）指的是 RPC 节点。这些节点可以被视为与网络交互并读取数据的网关。它们运行与完整验证者相同的软件，但设置不同，使其能够准确地模拟交易并维护当前状态的最新视图。截至本文撰写时，Solana 网络上有超过 4000 个 RPC 节点。与完整验证者节点不同，RPC 节点在网络中不持有任何股份。没有股份，它们无法投票或构建区块。此设置不同于大多数其他区块链，在那里验证者和 RPC 节点通常是相同的。由于 RPC 节点不获得质押奖励，因此运行 RPC 节点的经济学与获得奖励的验证者大相径庭，许多 RPC 节点作为开发者运行 Solana 应用程序的付费服务进行运营。Solana 的不同之处在于，它从一开始就被设计为无需内存池操作。与使用 gossip 协议在网络中随机广泛传播交易的传统区块链不同，Solana 将所有交易转发给预先确定的主验证者，即每个时隙的领导者。

![](https://img.learnblockchain.cn/attachments/migrate/1735874600886)

Solana 运营四个集群：Localnet、Testnet、Devnet 和 Mainnet-Beta。当人们提到 Solana 或 Solana 网络时，他们几乎总是指 Mainnet-Beta。Mainnet-Beta 是唯一一个代币具有真实价值的集群，而其他集群仅用于测试目的。

一旦 RPC 收到要包含在区块中的交易消息，它必须转发给领导者。在每个Epoch（大约每两天）之前都会生成一个领导者计划。即将到来的Epoch被分成多个时隙，每个时隙固定为 400 毫秒，并为每个时隙选择一位领导者。持有更多股份的验证者被选为领导者的机会更高。在每个时隙内，交易消息被转发给领导者，领导者有机会生成区块。当轮到某个验证者时，他们会切换到“领导者模式”，开始积极处理交易并将其广播到网络的其余部分。

* * *

### 权益加权服务质量 - SWQoS

在 2024 年初，Solana 引入了一种旨在防止垃圾邮件和增强 Sybil 抵抗的新机制，称为“权益加权服务质量”（SWQoS）。该系统使得领导者能够优先处理那些通过其他质押验证者转发的交易消息。在这里，持有更高权益的验证者被给予相对更高的容量来将交易消息包发送给领导者。这种方法有效地减轻了来自非质押节点的 Sybil 攻击。

![](https://img.learnblockchain.cn/attachments/migrate/1735874600901)

在这种模型下，验证者还可以与 RPC 节点达成协议，将其权益加权容量出租。作为回报，RPC 节点获得了更高的带宽，使他们能够在区块中实现更高的交易纳入率。值得注意的是，领导者的 80% 容量（2,000 个连接）被保留用于 SWQoS，剩余的 20%（500 个连接）则分配给来自非质押节点的交易消息。这种分配策略类似于高速公路上的优先车道，司机支付通行费以避免交通。SWQoS 影响了 Solana 生态系统，通过提高交易转发给领导者的要求并降低垃圾邮件攻击的有效性。这一变化激励了高流量应用程序垂直整合其操作。通过运行自己的验证者节点，或通过访问质押连接，应用程序可以确保享有优先访问领导者的权利，从而增强其交易处理能力。

* * *

### 关于 QUIC 的说明

在 2022 年底，Solana 采纳了 [QUIC](https://en.wikipedia.org/wiki/QUIC) 网络协议来管理交易消息向领导者的传输。此转变是由于网络遭受来自机器人在链上 NFT 铸造时的垃圾邮件攻击所导致的中断。QUIC 促进快速、异步的通信。

![](https://img.learnblockchain.cn/attachments/migrate/1735874600991)

QUIC 最初由 [Google](https://research.google/pubs/the-quic-transport-protocol-design-and-internet-scale-deployment/) 于 2012 年开发，试图提供两者的最佳特点。它提供类似于 UDP 的快速、异步通信，但具有 TCP 的安全会话和高级流量控制策略。这允许对网络中单个来源的流量施加限制，从而使网络能够专注于处理真实交易。它还具有独立流的概念，因此如果一个交易被丢弃，它不会阻塞剩下的交易。简而言之，QUIC 可以被视为试图结合 TCP 和 UDP 的最佳特点。

权益加权是 Solana 核心系统的一个反复出现的原则，包括投票奖励、涡轮树、领导者计划、海湾流和传播网络。拥有更高权益的验证者在网络中被赋予更高的信任和优先角色。

* * *

*   [下载完整报告](https://drive.google.com/file/d/1puEThjO9rmnZmIj_05WvU99FPmUiZ4pb/view?usp=sharing)

* * *

*   [返回顶部](#top)

* * *

![](https://img.learnblockchain.cn/attachments/migrate/1735874601070)

* * *

*“我们认为 SVM（Solana 虚拟机）在当前虚拟机技术中是最好的。”*—— *Andre Cronje, Fantom 基金会*

* * *

许多区块链网络在广播之前构建整个区块，称为离散块构建。相比之下，Solana 使用连续块构建，这涉及在分配的时间段内动态组装和流式传输区块，从而显著减少延迟。每个时隙持续 400 毫秒，每个领导者被分配四个连续的时隙（1.6 秒），然后轮换到下一个领导者。为了使区块获得接受，区块内的所有交易都必须有效且可被其他节点再现。在接管领导权的两个时隙之前，验证者会停止交易转发，以准备即将到来的工作。在此期间，入站流量激增，达到每秒超过一吉字节，因为整个网络会将数据包发送给即将到来的领导者。收到后，交易消息进入交易处理单元（TPU），这是负责区块生成的验证者核心逻辑。这里，交易处理序列以获取阶段开始，其中交易通过 QUIC 接收。随后，交易进入签名验证阶段，进行严格的验证检查。在这里，验证者验证签名的有效性，检查签名的数量是否正确，并排除重复的交易。

![](https://img.learnblockchain.cn/attachments/migrate/1735874601185)

* * *

### 银行阶段

银行阶段可以被描述为区块构建阶段。它是 TPU 中最重要的阶段，因其来自于“银行”。银行就是在某个给定区块时的状态。对于每个区块，Solana 都有一个银行，用于访问该区块的状态。当经过足够的验证者投票后，一个区块被最终确定，它们将把银行中的账户更新刷新到磁盘，从而使其永久化。链的最终状态是所有确认交易的结果。这个状态始终可以根据区块链历史以确定性方式重建。交易并行处理并打包成账本“条目”，每条目包含 64 个不冲突的交易批次。Solana 的并行交易处理变得简单，因为每个交易必须包括它所要读取和写入的所有账户的完整列表。这个设计选择给开发者带来了负担，但允许验证者通过轻松选择仅不冲突的交易，在每个条目内避免竞争条件。如果两个交易都试图写入同一个账户（两个写入），或者一个试图读取而另一个写入同一个账户（读 + 写），那么这些交易就会发生冲突。因此，冲突交易被放入不同的条目中并依次执行，而不冲突交易则并行执行。有六个线程并行处理交易，其中四个专用于普通交易，两个专门处理对 Solana 共识机制至关重要的投票交易。所有处理的并行化都是通过多个 CPU 核心完成的；验证者没有 GPU [要求](https://docs.solanalabs.com/operations/requirements)。一旦交易被分组为条目，它们就准备好由 Solana 虚拟机（SVM）执行。所需的账户被锁定；进行检查以确认交易是最新的，但尚未处理。加载账户，执行交易逻辑，更新账户状态。条目的哈希将被发送到历史证明服务进行记录（更多细节将在下一节中说明）。如果记录过程成功，所有更改将被提交到银行，并且在第一步中对每个账户施加的锁将被解除。执行由 SVM 完成，SVM 是使用 Solana 的 [rBPF](https://docs.rs/solana_rbpf/latest/solana_rbpf/) 分支构建的虚拟机，这是一个用于处理 JIT 编译和 eBPF 程序的虚拟机库。请注意，Solana 不要求验证者如何选择在区块内对交易进行排序。这种灵活性是一个关键点，我们将在本报告的经济学 + Jito 部分进一步讨论。

术语 SVM 可能含糊，因为它可以指“Solana 虚拟机”或“Sealevel 虚拟机”。这两个术语描述的是相同的概念，其中 Sealevel 是 Solana 的运行时环境的名称。尽管[最近有努力](https://www.anza.xyz/blog/anzas-new-svm-api)明确其边界，但 SVM 这个术语仍然被宽泛使用。

* * *

### 客户端

![](https://img.learnblockchain.cn/attachments/migrate/1735874601268)

Solana 是一个由数千个独立操作的节点组成的网络，这些节点协作以维护一个统一的账本。每个节点都是一台高性能机器，运行着相同的智能开源软件，称为客户端。Solana 启动时有一个唯一的验证者客户端软件——最初是 Solana Labs 客户端，现在称为 [Agave 客户端](https://github.com/anza-xyz/agave) ，它是用 Rust 编写的。从那时起，扩展客户端多样性就成了一个优先事项，而这将通过推出 [Firedancer 客户端](https://www.helius.dev/blog/what-is-firedancer)真正实现。Firedancer 是用 C 编程语言重写的原始客户端的完整重写。它由高频交易公司 Jump 的一支经验丰富的团队构建，承诺成为任何区块链上性能最强的验证者客户端。

* * *

*   [下载完整报告](https://drive.google.com/file/d/1puEThjO9rmnZmIj_05WvU99FPmUiZ4pb/view?usp=sharing)

* * *

*   [回到顶部](#top)

* * *

![](https://img.learnblockchain.cn/attachments/migrate/1735874601333)

* * *

_“我喝了两杯咖啡和一杯啤酒，熬夜到凌晨 4 点。我有了这个灵光一闪的时刻，像是使用相同 SHA-256 预像抗性哈希函数的工作量证明的谜题……我知道我拥有这个时间的箭头。”_— _Anatoly Yakovenko，Solana 联合创始人_

* * *

历史证明（PoH）是 Solana 的秘密武器，在每个验证者中充当一个特殊的时钟，促进网络的同步。PoH 为事件的顺序和时间的流逝建立了可靠的真实来源。最关键的是，它确保遵循领导者的时间表。尽管名称相似，历史证明并不是类似工作量证明的共识算法。

![](https://img.learnblockchain.cn/attachments/migrate/1735874601340)

随着网络的扩展，节点间的通信开销通常会增加，协调变得越来越复杂。Solana 通过将节点之间的通信替换为 PoH 本地计算来缓解这一问题。这意味着验证者可以通过一次投票就确认一个区块。消息中的可信时间戳确保验证者不能过早开始他们的区块，必须在提交区块之前等待最少的时间。在 PoH 的基础上是哈希算法的独特属性，具体来说是 [SHA256](https://en.wikipedia.org/wiki/SHA-2)：• 确定性：相同的输入将始终产生相同的哈希。• 固定大小：无论输入大小如何，输出哈希始终为 256 位。• 高效：计算任何给定输入的哈希速度快。• [预像抗性](https://en.wikipedia.org/wiki/Preimage_attack)：从哈希输出中查找原始输入在计算上是不可行的。• 雪崩效应：输入的微小变化（甚至一个比特）会导致哈希显著不同，这一特性称为雪崩效应。• [碰撞抗性](https://en.wikipedia.org/wiki/Collision_resistance)：找到两个不同的输入产生相同的哈希输出是不可行的。每个验证者客户端内，专用的“历史证明服务”不断运行 SHA256 哈希算法，创建哈希链。每个哈希的输入是前一个哈希的输出。这条链的作用相同于可验证延迟函数，因为哈希工作必须按顺序完成，未来哈希的结果无法提前得知。如果 PoH 服务创建了一个包含一千个哈希的链，我们就知道时间已经过去，因为它必须顺序计算每个哈希——这可以被视为一种“微型工作量证明”。然而，其他验证者可以并行验证这千个哈希的正确性，速度远快于它们的产生，因为每个哈希的输入和输出已经广播到网络。因此，PoH 难以产生但易于验证。不同 CPU 计算 SHA-256 的性能范围令人惊讶地狭窄，最快的机器之间只有小差异。尽管在优化该函数上投入了大量时间和精力，但一个常见的上限已经被达到，这在很大程度上是由于比特币对它的依赖。

![](https://img.learnblockchain.cn/attachments/migrate/1735874601385)

在领导者的时隙期间，PoH 服务将接收来自银行阶段的新处理条目。当前的 PoH 哈希与条目中所有交易的哈希相结合，形成下一个 PoH 哈希。这作为一个时间戳，将条目插入哈希链中，证明交易处理的顺序。这个过程不仅确认了时间的流逝，还作为交易的加密记录。  
在一个区块中，有 800,000 个哈希。PoH 流还包括“滴答”，这些是空条目，表示领导者的活跃状态以及时间的流逝，近似于一小部分秒。每 6.25 毫秒发生一次滴答，导致每个区块有 64 个滴答，总区块时间为 400 毫秒。验证者即使在不是领导者时也会持续运行 PoH 时钟，因为它在节点之间的同步过程中扮演着关键角色。

PoH 的主要好处是，即使区块生产者离线（即“失职”状态），也必须遵循正确的领导者时间表。PoH 防止恶意验证者在轮到他们之前产生区块。

* * *

*   [下载完整报告](https://drive.google.com/file/d/1puEThjO9rmnZmIj_05WvU99FPmUiZ4pb/view?usp=sharing)

![](https://img.learnblockchain.cn/attachments/migrate/1735874601426)

* * *

*   [回到顶部](#top)

* * *

![](https://img.learnblockchain.cn/attachments/migrate/1735874601530)

* * *

_“在 SVM 中分离代码和状态是最好的设计决策。祝福那些将这个概念虔诚地灌输到我脑中的嵌入式系统开发者们。”_— _Anatoly Yakovenko，Solana 联合创始人_

* * *

在 Solana 验证者内，全局状态存储在称为 AccountsDB 的账户数据库中。该数据库负责存储所有账户，无论是在内存中还是在磁盘上。账户索引中的主要数据结构是一个哈希映射，使得 AccountsDB 本质上是一个庞大的[键值存储](https://en.wikipedia.org/wiki/Key%E2%80%93value_database) 。在这里，键是账户地址，值是账户数据。随着时间的推移，Solana 账户的数量已激增至数亿。这一大数字部分是因为，正如 Solana 开发者喜欢说的那样，“在 Solana 上的一切都是一个账户！”

![](https://img.learnblockchain.cn/attachments/migrate/1735874601621)

* * *

### Solana 账户

账户是一个持久存储数据的容器，类似于计算机上的文件。它们有多种形式：• 用户账户：这些账户具有私钥，通常由钱包软件为用户生成。• 数据账户：这些账户存储状态信息，例如用户持有的特定代币的数量。• 程序账户：这些是包含可执行字节码的较大账户，类似于 Windows 上的 .exe 文件或 Mac 上的 .app 文件。• 原生程序账户：这些是特殊的预部署程序账户，执行网络的各种核心功能。 [示例](https://github.com/solana-labs/solana/tree/master/programs)包括投票程序和 BPF 加载器。所有账户都有以下字段：

| 字段 | 格式 | 描述 |
| --- | --- | --- |
| 拥有者 | 公钥地址 | 账户的拥有者。默认情况下，这是系统程序。 |
| Lamports | u64 | 账户持有的 SOL 数量，以 lamports（1 SOL 的十亿分之一）为单位。 |
| 数据 | 字节，可变长度 | 这是最重要的字段，类似于文件的内容。 |
| 租赁周期 | u64 | 向后兼容的遗留字段。稍后会详细介绍租赁。 |
| 可执行 | 布尔标志 | 如果账户持有可执行程序，则标记为“true”。 |

* * *

### 程序

Solana 程序账户仅包含可执行逻辑。这意味着当程序运行时，它会改变其他账户的状态，但自身保持不变。这种代码与状态的分离使 Solana 与其他区块链区分开来，并支持其许多优化。开发者主要使用 [Rust](https://www.rust-lang.org/) 编写这些程序，这是一种以安全性和性能为重点的通用编程语言 [已知](https://www.whitehouse.gov/wp-content/uploads/2024/02/Final-ONCD-Technical-Report.pdf)。此外，还有多个 TypeScript 和 Python 的 SDK 可用，以便于创建应用程序前端并实现与网络的程序化交互。许多常见功能由本地程序开箱即用地提供。例如，Solana 不要求开发者部署代码来创建代币。相反，指令被发送到一个预先部署的本地程序，该程序将设置一个账户来存储代币的元数据，从而有效地创建一个新代币。

* * *

### 租赁

租赁是一种旨在激励用户关闭账户并减少状态膨胀的机制。要创建一个新账户，账户必须持有最低余额的 SOL，称为“租赁豁免”金额。这可以视为为了保持账户在验证者内存中存活而产生的存储成本。如果账户的数据大小增加，最低余额的租赁要求也会成比例增加。当账户不再需要时，可以关闭该账户，租金将退还给账户拥有者。例如，如果用户持有以美元计价的稳定币，则该状态存储在一个代币账户中。目前，代币账户的租赁豁免金额为 0.002 SOL。如果用户将其全部稳定币余额转移给朋友，则可以关闭代币账户，用户将收回其 0.002 SOL。程序通常会自动处理用户的账户关闭。还有几个应用程序可帮助用户清理旧的未使用账户，并回收存储在其中的小额 SOL。

* * *

### 所有权

虽然读取账户数据是普遍允许的，但 Solana 的所有权模型通过限制谁可以修改（写入）账户数据来增强安全性。这个概念对于在 Solana 区块链上强制执行规则和权限至关重要。每个账户都有一个程序“所有者”。账户的拥有者负责管理该账户，确保只有授权的程序可以更改账户的数据。这个规则的一个显著例外是 lamports（SOL 的最小单位）的转移——增加账户的 lamports 余额是普遍允许的，无论所有权如何。

* * *

### 状态存储

Solana 程序作为只读可执行文件，必须使用“程序派生地址”（PDAs）来存储状态。PDA 是与程序相关联并由程序拥有的特殊类型账户，而不是特定用户。虽然普通 Solana 用户地址是从 Ed25519 密钥对的公钥派生的，但 PDA 没有私钥。相反，它们的公钥是从一组参数（通常是关键字或其他账户地址）以及拥有程序的程序 ID（地址）组合而来的。PDA 地址存在于“曲线外”，这意味着它们不在像普通地址那样的 Ed25519 曲线中。只有拥有 PDA 的程序可以以编程方式为其生成签名，确保只有它可以修改 PDA 的状态。

![](https://img.learnblockchain.cn/attachments/migrate/1735874601656)

上图：Solana 代币账户是程序派生地址（PDA）的具体示例。它们用于持有代币，并且“曲线外”存在。关联代币账户（ATA）程序确保每个钱包只能为每种代币类型拥有一个关联代币账户，从而提供了一种标准化的方式来管理代币账户。

* * *

*   [下载完整报告](https://drive.google.com/file/d/1puEThjO9rmnZmIj_05WvU99FPmUiZ4pb/view?usp=sharing)

* * *

*   [返回顶部](#top)

* * *

![](https://img.learnblockchain.cn/attachments/migrate/1735874601752)

* * *

*“关于 Solana 最有趣的部分不是并行化、SVM 或 Toly 的推文。它是你可能没有听说过的：Turbine。”*— *Mert Mumtaz, Helius*

* * *

在银行阶段，交易被组织成条目并发送到历史证明流进行时间戳处理。区块的银行被更新，条目现在准备进入下一个阶段——Turbine。Turbine 是领导者将其区块传播到网络其他部分的过程。受 [BitTorrent](https://www.bittorrent.com/) 启发，它旨在快速高效，减少通信开销并最小化领导者需要发送的数据量。

![](https://img.learnblockchain.cn/attachments/migrate/1735874601798)

Turbine 通过将交易数据分解为“碎片”来实现这一点，这个过程称为“碎片化”。碎片是小的数据包，最多 1280 字节，类似于视频流中的单个帧。当重新组装时，这些碎片允许验证者重放整个区块。碎片通过互联网在验证者之间使用 UDP 发送，并利用纠删码来处理数据包丢失或恶意丢弃数据包。 [纠删码](https://www.cs.cmu.edu/~guyb/realworld/reedsolomon/reed_solomon_codes.html#) ，一种基于 [多项式](https://en.wikipedia.org/wiki/Polynomial) 的错误检测和纠正方案，确保数据完整性。即使一些碎片丢失，区块仍然可以被重建。碎片被分组为称为前向纠错（FEC）批次的批次。默认情况下，这些批次由 64 个碎片组成（32 个数据碎片 + 32 个恢复碎片）。数据恢复在每个 FEC 批次中进行，这意味着在一个批次中最多可以丢失或损坏一半的数据包，所有数据仍然可以恢复。每个 64 碎片批次都经过默克尔化，根由领导者签名，并链接到前一个批次。这个过程确保碎片可以从网络中拥有它们的任何节点安全地获取，因为默克尔根的链提供了可验证的真实性和完整性路径。领导者最初向单个根节点广播，该节点将碎片传播到所有其他验证者节点。这个根节点在每个碎片中都会变化。验证者被组织成层，形成“Turbine 树”。持有较大股份的验证者通常位于树的顶部，而持有较小股份的则位于底部。

![](https://img.learnblockchain.cn/attachments/migrate/1735874601859)

该树通常跨越两到三个跳，具体取决于活动验证者的数量。为了视觉简化，上图描绘了 3 的扇出，但 Solana 的实际扇出值目前设置为 200。出于安全原因，树的顺序在每个新批次的碎片中轮换。这样的系统的主要目标是减轻领导者和根节点的出站数据流量压力。通过利用传输和重传的系统，负载在领导者和重传者之间分配，从而减少对任何单个节点的压力。

* * *

*   [下载完整报告](https://drive.google.com/file/d/1puEThjO9rmnZmIj_05WvU99FPmUiZ4pb/view?usp=sharing)

* * *

*   [返回顶部](#top)

* * *

![](https://img.learnblockchain.cn/attachments/migrate/1735874602171)

* * *

*“一些聪明的人告诉我，Solana 有一个诚实的聪明开发者社区……我希望这个社区能有其应有的机会蓬勃发展”*— *维塔利克·布特林，以太坊联合创始人*

* * *

一旦验证者通过 Turbine 从领导者那里收到一个新块，它必须验证每个条目中的所有交易。这涉及重放整个块，平行验证 PoH 哈希，按照 PoH 指定的顺序重建交易，并更新其本地银行。

![](https://img.learnblockchain.cn/attachments/migrate/1735874602083)

这个过程由交易验证单元（TVU）处理，这与领导者的交易处理单元（TPU）相似，TPU 是负责处理切片和块验证的核心逻辑。与 TPU 一样，TVU 流程被分为多个阶段，从接收切片的切片获取阶段开始。在随后的切片验证领导者签名阶段，切片经过多个有效性检查，最显著的是验证领导者的签名，这确保接收到的切片来自领导者。在重新传输阶段，验证者根据其在 Turbine 树中的位置，将切片转发给适当的下游验证者。在重放阶段，验证者精确地按顺序重建每个交易，同时更新其本地的银行版本。重放阶段类似于 TPU 中的银行阶段；这是最重要的阶段，更直接地描述为块验证阶段。重放是一个单线程的过程循环，协调许多关键操作，包括投票、重置 PoH 时钟和切换银行。

![](https://img.learnblockchain.cn/attachments/migrate/1735874602081)

上图：重放阶段负责将验证者切换到领导者模式并开始块生产。原始视觉由 Justin Starry 提供，Anza

* * *

### 共识

为了实现共识，Solana 使用塔 BFT（TBFT），这是对广为人知的实用 [拜占庭容错](https://en.wikipedia.org/wiki/Byzantine_fault)（PBFT）算法的定制实现，PBFT 通常被大多数区块链用来达成链的状态一致。像所有区块链一样，Solana 假设网络中存在恶意节点，因此系统必须承受的不仅仅是节点故障，还有一定程度的攻击。塔 BFT 的独特之处在于利用了 Proof of History 提供的同步时钟。虽然传统的 PBFT 需要多轮通信才能达成交易顺序的共识，但 Solana 节点利用已预先确定的事件顺序，大大降低了消息开销。

* * *

### 投票

为了参与共识并赚取奖励，验证者为他们认为有效（即，没有双重支付或错误签名等问题）并应被视为规范的块提交投票。验证者为这些投票支付交易费用，这些投票由领导者处理并与常规用户交易一起包含在一个块中。这就是为什么 Solana 交易通常被分类为投票交易和非投票交易。当验证者提交正确和成功的投票时，他们会获得积分。该机制激励验证者投票选择他们认为最有可能被包含的分叉，即“最重”的分叉。

* * *

### 分叉

Solana 设计的一部分，使其如此快速，是网络在生产新块之前并不等待所有验证者达成对新生产块的共识。因此，将两个不同的块与同一父块关联，并创建分叉并不罕见。Solana 验证者必须对这些分叉进行投票，并使用共识算法来决定采用哪个分叉。当存在竞争的分叉时，网络最终只会确认一个分叉，而丢弃的分叉中的块将被抛弃。每个插槽都有一个预定的领导者，只有该领导者的块会被接受；一个插槽不能有两个提议的块。因此，潜在分叉的数量仅限于在领导者轮换插槽的边界处可能出现的“存在/不存在”跳过列表。一旦验证者选择了一个分叉，它将承诺这一分叉，直到锁定时间到期，这意味着它必须在最小时间内坚持其选择。

![](https://img.learnblockchain.cn/attachments/migrate/1735874602187)

Solana 的“跳过率”——未生产块的插槽百分比——在 2% 到 10% 之间，而分叉是这些跳过插槽的主要原因。跳过插槽的其他可能原因包括新Epoch的开始、领导者下线或生产无效块。

在 Solana 上，交易的状态取决于其在共识过程中的当前阶段：• 已处理：交易已被包含在一个块中。• 已确认：交易的块已被三分之二的超大多数投票。• 已最终确定：在交易的块上构建的块超过 31 个。迄今为止，在 Solana 的历史上，从未出现过（乐观）确认的块没有最终确定的情况。

对于每个块，Solana 使用一个银行来访问该块的状态。当银行被最终确定时，该银行及其祖先的账户更新将刷新到磁盘。此外，来自早期非最终银行的任何账户更新都将被修剪。这个过程使 Solana 能够高效地维护多个潜在状态。

* * *

*   [下载完整报告](https://drive.google.com/file/d/1puEThjO9rmnZmIj_05WvU99FPmUiZ4pb/view?usp=sharing)

* * *

*   [返回顶部](#top)

* * *

![](https://img.learnblockchain.cn/attachments/migrate/1735874602234)

* * *

*“区块链需要将加密学、分布式系统、操作系统和编程语言进行巧妙结合。Solana 的超能力在于愿意无畏地面对每个学科中最有趣的问题。”*— *格雷格·菲茨杰拉德，Solana 联合创始人*

* * *

八卦网络可以被视为 Solana 网络的 [控制平面](https://en.wikipedia.org/wiki/Control_plane)。与处理交易流的数据平面不同，控制平面传播有关区块链状态的重要元数据，例如联系信息、分类帐高度和投票信息。如果没有八卦，验证者和 RPCs 将不知道哪些地址和端口可以进行跨服务通信。新节点也依赖八卦加入网络。Solana 的八卦协议使用非正式的点对点通信，采用受修改的 PlumTree 算法启发的树广播方法。这种方法高效地传播信息，无需依赖任何中心源。八卦在某种程度上作为一个孤立系统，独立于大多数其他验证者组件。验证者和 RPC 每 0.1 秒通过 UDP 共享签名数据对象，确保信息在网络中的可用性。所有的八卦消息必须小于或等于最大传输单元（MTU）1280 字节，在代码库中称为“包结构”。八卦记录是节点之间共享的实际数据对象。大约有 10 种不同类型的记录，每种记录服务于不同的目的。八卦记录是签名的、版本化的，并带有时间戳，以确保完整性和时效性。

有四种类型的八卦消息：• 推送：最常见的消息，与一组“推送对等体”共享信息。• 拉取和拉取响应：定期检查未接收的消息，拉取响应将返回节点没有的信息。• 修剪：允许节点选择性减少其维护的连接数量。• Ping 和 Pong：节点的健康检查——如果发送了 ping，期待返回 pong，指示对等节点仍然处于活动状态。八卦数据存储在集群复制数据存储（CrdsTable）中。该数据结构可以变得非常大，需要定期修剪。

* * *

### 归档

Solana 与其他区块链的不同之处在于，它不需要完整的历史记录就能确定一个账户的当前状态。Solana 的账户模型确保在任何给定的Slot状态都是已知的，从而使验证者能够存储每个账户的当前状态，而无需处理所有历史区块。RPC 和验证者在设计上不会保留完整的历史账本。相反，它们通常只存储 1 或 2 个时期（2-4 天）的交易数据，这对于验证链的尖端是足够的。档案目前由“仓库节点”管理，这些节点由专业的 RPC 服务提供商、Solana 基金会及其他对确保交易历史可用的生态系统参与者运营。仓库节点通常维护以下一个或两个内容：  
分类账档案：上传原始分类账和适合从头重放的 AccountsDB 快照。  
Google Bigtable 实例：存储从创世区块开始的区块数据，格式化以服务于 RPC 请求。

* * *

*   [下载完整报告](https://drive.google.com/file/d/1puEThjO9rmnZmIj_05WvU99FPmUiZ4pb/view?usp=sharing)

* * *

*   [回到顶部](#top)

* * *

![](https://img.learnblockchain.cn/attachments/migrate/1735874602248)

* * *

*“人们意识到 Solana 是目前唯一能够支持主流消费应用的链。”*— *Ted Livingston，Code 创始人*

* * *

Solana 通过每个时期生成新的 SOL 代币来分配质押奖励，采用通胀机制。这一过程导致非质押者的网络份额相对于质押者减少，从而使财富从非质押者转移到质押者。通胀于 2021 年初以 8% 的初始速率开始，年度递减 15%，直至稳定在长期 1.5% 的速率。

![](https://img.learnblockchain.cn/attachments/migrate/1735874602436)

任何 SOL 代币持有者都可以通过将代币质押到一个或多个验证者来赚取奖励并帮助保护网络。将代币分配给验证者称为委托。将代币委托给某个验证者表明对该验证者的信任。但这并不意味着验证者对代币拥有所有权或控制权。所有质押、解除质押和委托操作都在下一个新时期开始时执行。

* * *

### 投票奖励

当验证者提交有效且成功的投票时，他们会获得信用。投票交易费用为 0.000005 SOL，免除优先费用。投票费用大约为每个验证者每天 1 SOL，成为运行验证者的主要运营成本。在一个时期内，验证者通过投票积累信用，他们可以在时期结束时用这些信用兑换通胀的一部分。表现最佳的验证者成功地对约 90% 的Slot进行投票。请注意，没有区块的Slot（跳过Slot率）的比例在 2% 到超过 10% 之间，这些Slot无法投票。平均而言，验证者成功投票的Slot约占 80%，在 432,000 个Slot的时期中获得 345,600 个信用。总通胀池首先根据时期内获得的信用进行划分。验证者在总信用中的份额（其信用除以所有验证者信用的总和）决定了他们的相应奖励。这进一步通过质押进行加权。因此，拥有 1% 总质押的验证者如果拥有平均数量的信用，应该大约获得 1% 的总通胀。如果他们的信用高于或低于平均水平，他们的奖励将相应波动。投票表现的差异是验证者提供给质押者的回报（以 APY 衡量）各不相同的原因之一。另一个因素是验证者收取的佣金费率，该费率是指向其验证者的总通胀奖励的一定百分比。此外，验证者离线或与区块链不同步（称为失职）也会显著影响回报。

* * *

### 区块奖励

被指定为特定区块的领导者的验证者可获得额外的区块奖励。该奖励包括区块内所有交易的 50% 基础费用和 50% 优先费用，其余费用将被销毁。仅产生区块的验证者才能获得这些奖励。与每个时期分配的质押奖励不同，区块奖励在区块生成时立即记入验证者的身份账户。

* * *

### 流动质押

流动质押已成为本地质押的热门替代方案。参与者在质押其 SOL 后收到一种称为流动质押代币（LST）或流动质押衍生品（LSD）的代币，通常是在通过多个验证者委托其代币的质押池中。新收到的 LST 代币代表用户在质押的 SOL 中的份额。这些代币可以交易、在应用程序中使用或转移给他人，同时仍然赚取质押奖励。该系统的主要优势是它显著提高了资本效率。  
LST 的价格 = （池中总质押 SOL * SOL 价格）/ 总铸造 LST 含量  
在传统的本地质押中，随着时间的推移，质押者将直接积累更多的 SOL。而在流动质押中，奖励会再投资回池中，从而增加 LST 的公允价值。只要存在兑换 LST 为基础质押 SOL 的机制，套利交易者将确保代币价格保持合理。

* * *

### Jito

截至目前，超过 80% 的 Solana 质押采用 Jito 客户端验证者软件。该客户端是原 Agave 客户端的一个分支，推出了一种协议外的区块空间拍卖，为验证者提供额外的经济激励。这个额外的激励是 Jito 客户端在验证者中广泛采纳的主要因素。当领导者使用 Jito 客户端验证者时，他们的交易首先会被导向 Jito 转发器。这个开源软件作为交易代理路由器。其他网络节点对 Jito 转发器的存在毫不知情，因为它们只是将交易发送到领导者在传播网络上宣传作为其 ingress_socket 的地址和端口配置，认为这是领导者的。

![](https://img.learnblockchain.cn/attachments/migrate/1735874602457)

转发器在转发交易给领导者之前，会将所有交易保存 200 毫秒。这个“速度障碍”机制延迟了传入交易消息，提供了一个短暂的进行拍卖的窗口。在 200 毫秒后，转发器乐观地释放交易，而不考虑拍卖结果。区块空间拍卖通过 Jito 区块引擎在链下进行，允许搜索者和应用程序提交一组原子执行交易，称为交易包。这些交易包通常包含时间敏感的交易，例如套利或清算。Jito 对所有小费收取 5% 的费用，最低小费为 10,000 lamports。小费完全在协议外运作，与协议内的优先和基础费用分开。此前，Jito 还运行了一个规范的协议外记忆池服务，但现在已被弃用。

* * *

*   [下载完整报告](https://drive.google.com/file/d/1puEThjO9rmnZmIj_05WvU99FPmUiZ4pb/view?usp=sharing)

![](https://img.learnblockchain.cn/attachments/migrate/1735874602577)

* * *

### 免责声明和方法论

本报告中呈现的观点和解释仅代表作者个人观点，并不代表 Turbin3、Helius、Solana 基金会、Solana Labs 或任何其他实体的看法。本研究通过对文档的审查、文献分析、代码检查、与生态系统参与者的访谈以及作者的独立研究进行。本文档中的内容不应被误解为对购买 SOL 代币的认可或建议。该内容仅供参考，不构成投资建议。

* * *

*   [返回顶部](#top)

* * *

> 我是 [AI 翻译官](https://learnblockchain.cn/people/19584)，为大家转译优秀英文文章，如有翻译不通的地方，在[这里](https://github.com/lbc-team/Pioneer/blob/master/translations/10486.md)修改，还请包涵～