
>- 原文链接：[threesigma.xyz/blog...](https://threesigma.xyz/blog/automated-market-makers)
>- 译者：[AI翻译官](https://learnblockchain.cn/people/19584)，校对：[翻译小组](https://learnblockchain.cn/people/412)
>- 本文链接：[learnblockchain.cn/article…](https://learnblockchain.cn/article/9840)
    
## 介绍

本文提供了当前**去中心化金融自动化市场制造商（AMM）生态系统**的全面概述，重点关注这些协议的功能，而非其投资潜力。

作为更广泛系列的一部分，我们将探讨各种**去中心化交易所（DEX）模型**，首先从 AMM 开始。我们的目标是分解促成特定协议成功的机制和优势。

每个 AMM 将根据其**部署年份**和具体**实施模型**进行分析。我们将突出每个协议的独特特性、**核心组件**以及它支持的不同**用例**。此外，我们还将探讨这些模型面临的挑战，并讨论它们最适合的**市场细分**。


> 本文作者：在 Three Sigma，我们认识到 Web3 领域中的复杂机会。我们位于里斯本的专家团队提供开发、安全和经济建模的优质服务，以推动你项目的成功。无论你需要精确的代码审计、先进的经济建模，还是全面的区块链工程，Three Sigma 都是你值得信赖的合作伙伴。访问我们的 [网站](https://threesigma.xyz/) 以了解更多信息。

我们不仅是代码、经济审计和区块链工程的专家——我们热衷于分解 Web3 概念，以推动行业的清晰度和采用。

以下 33 个协议被纳入：

*   [1Inch](https://1inch.io/), [Aerodrome](https://aerodrome.finance/), [Algebra](https://algebra.finance/), [Ambient](https://ambient.finance/), [Arrakis](https://www.arrakis.finance/), [Balancer](https://www.notion.so/e8e2597e76884bbb809babd90f47642e?pvs=21), [Bancor](https://bancor.network/), [Carbon](https://www.carbondefi.xyz/), [CoW](https://www.notion.so/e8e2597e76884bbb809babd90f47642e?pvs=21), [Curve](https://curve.fi/#/ethereum/swap), [DODO](https://dodoex.io/en), [Frax](https://frax.finance/), [Gamma](https://www.gamma.xyz/), [Gyroscope](https://gyro.finance/), [Kyber](https://www.notion.so/e8e2597e76884bbb809babd90f47642e?pvs=21), [Maverick](https://www.mav.xyz/), [Melow](https://mellow.finance/), [Orca](https://www.orca.so/), [Osmosis](https://osmosis.zone/), [PancakeSwap](https://pancakeswap.finance/), [Pendle](https://www.pendle.finance/), [PoolShark](https://www.poolshark.fi/), [Raydium](https://v2.raydium.io/), [Sorella Labs](https://sorellalabs.xyz/), [Sushi](https://www.sushi.com/swap), [Thena](https://thena.fi/), [Trader Joe](https://traderjoexyz.com/), [Uniswap](https://uniswap.org/), [Valantis](https://www.valantis.xyz/), [Velodrome](https://velodrome.finance/), [VVS](https://vvs.finance/), [Wombat](https://www.wombat.exchange/), [WOO](https://woo.org/)。

## 什么是 AMM？

自动化市场制造商是基于去中心化交易池的协议，允许用户直接向市场提供流动性，从而让其他人买卖代币。

它们代表了去中心化金融的重大进步，提供了相对于传统链上订单簿模型的某些优势，例如持续的流动性提供、更快的交易、减少对市场制造商的依赖以及简化用户的市场访问。

较旧的系统常常面临诸如过高的网络交易费用和由于完全链上管理每个订单的低效率而导致的高延迟等挑战。Etherdelta 是一个从 2016 年到 2018 年运营的早期 DEX，采用订单簿模型，面临类似问题，突显了去中心化空间中对更高效交易解决方案的需求。与我们在永久期货市场上看到的类似，早期项目也面临监管审查。2018 年，Etherdelta 遭到 [SEC](https://www.sec.gov/newsroom/press-releases/2018-258) 的指控。

AMM 的概念在 2017 年开始形成，当时 Bancor 发布了一份白皮书，介绍了一种基于绑定曲线的新定价机制。尽管其方法受到批评，Bancor 的系统因无法动态适应真实市场条件而受到批评。批评者指出，Bancor 的公式化定价仅依赖于代币储备而非市场均衡，使该协议在极端市场事件中脆弱。例如，在银行挤兑或恐慌性抛售期间，Bancor 会继续以高于零的价格提供流动性，即使市场情绪崩溃，导致其储备耗尽。

几个月后，Vitalik 发布了 "[On Path Independence](https://vitalik.eth.limo/general/2017/06/22/marketmakers.html)"，一篇理想化 AMM 未来的文章，并介绍了常数乘积 AMM（CPMM）概念，这将成为最著名的 AMM 模型之一，并成为 Uniswap v1 的基础。

在 2017 年底，[Hayden Adams](https://x.com/haydenzadams) 设计了一个概念验证 AMM。Uniswap V1 一年后推出，成为加密领域第一个广泛成功的 CPMM。

经过几年的发展，AMM 继续增长，成为第四大 DeFi 类别 DEX 的主要子行业，与其他子行业相比，活跃协议数量最多。DEX 目前落后于流动质押、借贷和桥接领域。

![](https://img.learnblockchain.cn/attachments/migrate/1731308093043)

_来源:_ [https://defillama.com/categories](https://defillama.com/categories)

## 研究

在本系列中，我们探讨 AMM 协议，围绕决定其性能和采用的基本变量进行分析。我们的目标是提供对 AMM 协议和模型之间差异及操作效率的全面理解。

为此，我们根据**两个变量**对协议进行了分类。

**价格发现：** 确定资产价格的过程。该机制在交易进行时调整价格，反映市场需求和供应。

*   **内部链上价格发现** → 价格由 AMM 内部的流动性池中资产的比例决定，随着交易的进行而调整。
*   **外部链下价格发现** → 系统内的价格受到外部市场数据的影响，这些数据通过预言机、求解器(solvers)或其他外部数据源集成。

**流动性来源：** 使 AMM 内部交易得以进行的资产的来源和管理。流动性来源影响定价、滑点和整体市场效率。

*   **内部流动性** → AMM 仅依赖于其池内提供的流动性。价格根据池内资产比例进行调整，但在波动期间可能面临更高的滑点。
*   **外包流动性** → 外部来源被集成，因为协议不依赖于内部流动性。

![](https://img.learnblockchain.cn/attachments/migrate/1731308093485)

_注意：AMM 是 DEX 的一个特定子行业，其他类型如订单簿和 RFQ 也存在于更广泛的设计空间中。然而，我们专注于 AMM，因为它们代表了一种高度去中心化且有趣的原语，使完全链上、点对池（P2Pool）交互成为可能。_

为了便于可视化协议及其对应的启动和活跃时期，我们创建了一个时间轴，展示大多数协议及其重要版本。

这个时间线将聚焦于研究发展的三个特定时期。

![](https://img.learnblockchain.cn/attachments/migrate/1731308093477)

* * *

### 2016-2018：AMM 的实验阶段

AMM 的早期发展是一个重要的实验和创新时期。这个初始阶段引入了恒定函数市场制造商（CFMM）的概念，开创了将扩展到包括多代币流动性池和为稳定币量身定制的不变函数的机制。这里的基础模型为后续多样化和复杂的 AMM 系统奠定了基础。

![](https://img.learnblockchain.cn/attachments/migrate/1731308093487)

#### 恒定函数市场制造商（CFMM）

CFMM 是 AMM 的基础模型，因为它引入了预定义的数学函数来确定流动性池内资产的定价。核心原则是该函数的输出在交易前后*保持不变*，确保池内资产的余额遵循特定规则。

CFMM 的一般形式为 f(x1,x2,…,xn)=k，其中 {x1,x2,…,xn} 是池中不同资产的数量，而 _k_ 是一个常数。

在这样的系统中，交易对的存款在智能合约中汇集，允许交易者使用这种组合流动性直接与池进行代币交换，而不需要为每笔交易寻找单独的交易对手。

必须将 CFMM 与**绑定曲线**区分开来——另一种利用数学函数影响定价的概念，但在代币发行的背景下，而不是交易流动性。

**绑定曲线**描述了**代币价格与其供应之间的关系**。该模型规定，随着更多代币的购买，价格沿曲线上升；相反，随着代币的出售，价格下降。

另一方面，**CFMM**管理流动性池内多个代币之间的互动，确保交易在基于池的储备的情况下保持这些代币之间的恒定关系。CFMM 的功能旨在平衡不同代币的数量，以促进流动性并实现资产之间的交易。

在 CFMM 概念的基础上，出现了几种 AMM 的子类别，如**恒定乘积市场制造商**、**恒定总和市场制造商**和**恒定均值市场制造商**。这些模型构成了由 Bancor、Curve 和 Uniswap 等协议推广的第一代 AMM 的一类。

#### 恒定乘积市场制造商（CPMM）

第一种获得广泛关注的 CFMM 类型，特别是通过 Bancor 和 Uniswap。

CPMM 基于基本公式**x \* y = k**，根据每种代币的可用数量（流动性）建立两种代币的价格范围。

在 CPMM 中，如果由于交易而导致一种代币的供应增加，则另一种代币的供应必须减少，以保持恒定乘积**k**。

在图形上，这种关系由双曲线表示，显示流动性始终可用，但随着一种代币变得越来越稀缺，价格会逐渐提高，价格在可用性缩小时会朝着无穷大上升。

![](https://img.learnblockchain.cn/attachments/migrate/1731308093482)

在 Bancor CPMM 初步成功的基础上，[**Uniswap**](https://uniswap.org/) 采用了该模型，以简化代币交换并增强流动性提供。

Uniswap v1 虽然最初成功，但存在关键限制——例如要求所有代币对都基于 ETH，导致 ERC-20 交换效率低下且成本高昂，并且缺乏强大的价格预言机，使其容易受到操纵——这些问题在 Uniswap v2 中得到了改善，使其至今仍被广泛使用。

在 UNIv2 中，为不同代币对创建流动性池。对于给定的池，设 x 表示**Token_0**的代币数量，y 表示**Token_1**的代币数量。Uniswap 使用的交易函数为φ(x,y)=xy，定义了池内的有效交易。

核心原则是，如果函数φ在交易前后保持不变，则交易是有效的。这意味着代币储备的乘积必须保持不变，遵循 CPMM 模型。

为了解决 V1 的问题，Uniswap V2 开发了新功能，主要包括：

*   **ERC-20 对。** 在 Uniswap V1 中，以 ETH 作为池的基础代币简化了路由，但也带来了更高的交易费用。为了将 USDC 兑换为 USDT，用户被迫通过 ETH 中介执行两步过程（USDC-ETH，然后 ETH-USDT），导致额外成本。V1 和 V2 都使流动性提供者面临由于配对资产如 ETH 的价格波动而导致的无常损失。然而，Uniswap V2 支持任何 ERC-20 代币的直接配对，如 USDC-USDT，减少了路由效率低下和交易成本。
*   **价格预言机。** Uniswap V2 可以用作价格预言机，方法如下。Uniswap 在每个区块中记录到目前为止价格的累积和：at=∑i=1tpia_t = \\sum_{i=1}^t p_i。这个记录是在每个区块的第一次交易之前进行的。设 pt1,t2=(t2−t1)−1∑i=t1t2pip_{t_1,t_2} = (t_2 - t_1)^{-1} \\sum_{i=t_1}^{t_2} p_i 为\[t1,t2\]\[t_1, t_2\]之间的时间加权平均价格（TWAP）。如果有人希望使用 Uniswap 作为价格预言机，使用特定的 pt1,t2p_{t_1,t_2}作为价格的度量，他们只需知道 at1,at2a_{t_1}, a_{t_2}即可有效计算 pt1,t2=(t2−t1)−1(at2−at1)p_{t_1,t_2} = (t_2 - t_1)^{-1} (a_{t_2} - a_{t_1})。使用平均价格作为预言机而不是某一时刻的价格的原因在于，前者不易受到操纵。
*   **闪电交换。** 闪电交换使交易者能够在同一交易区块内接收代币并执行多个交换，而无需提前支付。这一功能确保在交易后保持恒定乘积规则，促进跨不同平台的复杂套利策略，而无需预先资本。如果交易未在同一区块内完成，则会失败。

#### 恒定总和市场制造商（CSMM）

CSMM 是另一种旨在以零价格滑点促进交易的模型，遵循公式 x+y=k，并在图形上表示为一条直线。该模型保持储备总和不变，理想情况下允许无滑点交易。

然而，CSMM 容易受到套利的影响，特别是当外部市场价格比率偏离 1:1 时。套利者可以利用这些差异，耗尽一种储备，使池的流动性减少，无法进行进一步交易。由于这些风险，CSMM 在 AMM 平台上并未得到广泛采用，因为它们容易出现流动性问题和市场操纵。

[**Trader Joe**](https://lfj.gg/avalanche/)引入了一种名为流动性书的设计，结合了 CSMM 模型的元素。与传统的 CSMM 不同，后者容易受到套利和流动性耗尽的影响，Trader Joe 的实现使用离散化的箱结构来减轻这些风险，同时仍然利用特定价格范围内零滑点交易的好处。在流动性书的每个箱内，该模型表现得像一个 CSMM，在狭窄的价格范围内提供恒定总和动态。

例如，考虑一个 ETH/USDC 池，包含两个相邻的区间：

1.  区间 A：ETH 价格在 1000.00 和 1010.00 USDC 之间
2.  区间 B：ETH 价格在 1010.00 和 1020.00 USDC 之间

每个区间都作为其自己的迷你 CSMM 池。只要交易完全发生在区间 A 或区间 B 内，就会以零滑点执行。这是因为在每个区间内，价格是固定的，资产的比例只是沿着恒定总和线移动。

* * *

### 2019-2021 - DeFi 夏季

第一个 AMM 的推出标志着 DeFi 的重大创新，但也面临挑战。

早期的 AMM 遇到了 **无常损失** 等问题，流动性提供者在池价格分歧时相较于持有代币会遭受损失，以及 **低资本效率**，导致大量流动性未被充分利用，并增加了交易的价格影响。

另一个挑战是损失与再平衡（LVR），这是一种套利形式，当 AMM 的价格与其他市场相比过时时，允许交易者利用价格差异，损害流动性提供者。由于 CFMM 使用恒定产品公式，它们特别容易受到此问题的影响，因为其定价静态，导致流动性提供者在套利者在更具流动性的场所进行再平衡时遭受损失。

尽管技术有所进步，这些问题在许多平台上依然存在，给 AMM 领域的效率和盈利能力带来了持续挑战。

随着 DeFi 领域的成熟，特别是在 2020-2021 年“DeFi 夏季”的爆炸性增长期间，新的 AMM 协议相继出现，或作为分叉，或作为全新模型，以解决基础性挑战。这些协议在早期设计的基础上进行了迭代，结合了新机制，增加了动态性，以解决低效问题并增强功能。

以太坊 Layer 2 的出现进一步推动了这一创新，为其他模型的创建提供了基础，如 **混合自动化做市商**、**动态自动化做市商**、**主动做市商** 和 **虚拟自动化做市商**。这些模型引入了更智能的流动性管理、动态费用结构和与外部市场更好价格对齐的特性。

![](https://img.learnblockchain.cn/attachments/migrate/1731308093479)

### 重要升级

#### Uniswap v3

Uniswap v3 代表了相较于其前身的重大进化，建立在其基础方面的同时，结合了新机制，提高了效率，并为用户提供了更多控制其交易策略的能力。

**Uniswap v3 的关键升级：**

1.  **集中流动性：**
    *   Uniswap V3 的定义特征称为集中流动性。大致来说，它的工作原理如下。存在价格刻度 pi\=1.0001ip\_i = 1.0001^i，对于 i∈Zi \\in \\Z。对于每个刻度 ii，存在流动性 Li∈RL\_i \\in \\R。如果当前价格为 p∈\[pi,pi+1\]p \\in \[p\_i, p\_{i+1}\]，（pp 是 `coin_0` 相对于 `coin_1` 的价格）那么在交易过程中应保持的恒等式是 (x+Li/pi+1)(y+Lipi)\=Li2(x + L\_i/\\sqrt{p\_{i+1}})(y + L\_i \\sqrt{p\_i}) = L\_i^2。请注意，交易执行过程中价格会发生变化，每个在特定刻度内发生的交易部分应使用适当的恒等式。
2.  **灵活费用：**
    *   针对 v2 的一刀切费用方法，Uniswap v3 提供了多个费用层级（0.05%、0.3%、1%）。这使得流动性提供者能够将费用与其提供流动性所面临的风险对齐。涉及更高波动资产的池可以收取更高的费用，以补偿流动性提供者可能遭受的无常损失。
3.  **高级预言机升级：**
    *   V3 通过使用时间加权几何平均数进行价格计算，改进了预言机功能，确保无论交易方向如何，预言机价格都是一致的。这一增强解决了 v2 中价格报告的差异，并为依赖准确价格数据的 DeFi 应用提供了更可靠的数据。
4.  **区间订单：**
    *   区间订单增加了用户在特定价格区间内进行交易的能力，有效地创建了限价订单。

Uniswap V3 提供了几个比较优势。

对于交易者而言，集中流动性和区间订单的引入减少了滑点，确保了更好的价格执行，降低了交易成本，并给予他们对交易的更多控制。对于流动性提供者而言，**w**hile v3 允许他们将资金集中在他们预期将最活跃的价格区间，但这要求他们积极管理投资并制定策略以最大化回报。这增加了一层复杂性，但也为他们所选择的区间内的交易量增加带来了潜在的更高费用和奖励。

#### Bancor V3

[Bancor](https://bancor.network/) V3 引入了优化其 AMM 的进步，成为动态 AMM，关键特征是全池架构，以及以下两个附加特征：

*   **单一流动性池**：与之前版本中每个代币对需要单独流动性池不同，Bancor V3 将所有流动性整合到一个单一池中，称为 **Omnipool**。这一创新大幅减少了交易不同代币对所需的交易次数，因为它消除了“二次跳跃”交易的需要。
*   **高效代币交换**：为了减少交换的 gas 费用和滑点，在 Omnipool 中，任何两个代币之间的交易都是直接执行的，无需先转换为中间代币。

V3 还引入了“**无限池**”，允许无限制的单边质押。通过取消对流动性提供给池的上限，协议可以在需求增加时扩展流动性，而无需等待池中可用空间。

其他特性：

*   **动态费用调整**：Bancor V3 允许根据市场条件动态调整交易费用。这种灵活性有助于平衡流动性提供者的风险和回报，特别是在波动市场条件下。
*   **BNT 质押和奖励**：随着 Omnipool 的引入，BNT 质押者现在可以从所有代币对的交易费用中受益，而不仅仅是他们直接参与的代币对。这种广泛的曝光最大化了利益相关者的费用生成机会。
*   **即时无常损失保护（已移除）**：一个不再激活但值得强调的特性是 Bancor V3 的即时 IL 保护。与 V2.1 中 IL 保护在 100 天内逐渐提升至 100% 不同，V3 从流动性存入的那一刻起就提供全面的 IL 保护。这种即时保护伴随着最低的提前撤回罚金，以防止频繁的进出交易，从而稳定流动性。然而，在 2022 年 6 月的极端市场波动中，维持这种保护的成本急剧上升。大型实体抛售奖励以覆盖负债，加上大量 BNT 空头头寸，形成了一个反馈循环，导致 BNT 贬值引发更多 IL，需更多 BNT 发行。这最终迫使 Bancor 在协议的财务储备不足以覆盖损失时暂停 IL 保护特性，削弱了其可靠性。

#### 混合 CFMMs

随着基于 AMM 的流动性不断发展，我们看到了混合 CFMM 的出现，它通过整合各种 AMM 模型的特性，提供了更大的灵活性和效率。这些先进的设计可以优化流动性管理，调整 LP 的风险敞口，同时最小化交易者的价格影响。

一个高效的混合 CFMM 的例子是 [**Curve**](https://curve.fi/)。Curve 的模型结合了 **CPMM** 和 **CSMM** 的元素，创造了密集的流动性口袋，减少了特定交易范围内的价格影响。

最终的价格曲线大多是线性的，提供低价格影响的交易，但在流动性接近极限时变为抛物线。这确保了流动性被有效利用，使 LP 通过更高的资本效率获得更多收益，同时套利者也能重新平衡池子。

![](https://img.learnblockchain.cn/attachments/migrate/1731308093957)

Curve 特别以提供低价格影响的代币交换而闻名，具有相对稳定的 1:1 汇率，使其非常适合稳定币或挂钩资产。然而，Curve 很快扩展了其能力，以支持更具波动性的代币对。池子通过将流动性集中在当前市场价格附近，更有效地使用流动性，并在交易发生时动态调整，以保持平衡而不对池子造成损失。

此外，Curve V2 引入了 **动态挂钩模型**，进一步优化流动性集中并最小化滑点。这个动态挂钩是针对挑战而开发的，例如 stETH 脱钩危机，在此期间，稳定资产池经历了流动性失衡和市场价格扭曲。动态挂钩允许 Curve 根据市场条件调整池子的内部价格，使用以下变量：

*   γ，决定流动性如何集中在挂钩点附近，以及
*   ss，调整池子的价格朝向预言机价格 p*
*   A，放大系数，塑造流动性曲线以减少价格波动影响。𝐴 越高，线条越不弯曲，减少相对价格波动并最小化对池子的影响。

此功能在市场价格波动时动态地将流动性转移到价格点，使池子能够迅速适应市场变化，而无需 LP 手动重新平衡。

Curve 的池子还具有 **可变费用**（范围从 0.04% 到 0.40%），根据资产价格与内部预言机的接近程度而变化。这些特性的组合使 Curve 在稳定和波动资产交易中都非常高效，而其动态挂钩模型和智能流动性管理确保了在 DeFi 中的竞争表现。

#### 动态自动化做市商 (DAMM)

**DAMM** 实时调整关键参数，如费用、流动性和储备比率，以适应市场条件。

与在固定价格范围内集中流动性的混合 AMM 不同，DAMM 为管理不可预测资产提供了更多灵活性。例如，**Sigmadex** 使用 DAMM 模型，利用 Chainlink 价格馈送和隐含波动性动态调整 AMM 曲线的行为。这意味着它不是重新分配流动性，而是根据外部市场条件动态调整 **定价曲线的形状和斜率**，从而更有效地应对市场波动。

**DAMM** 动态调整其算法，结合多个变量以适应不断变化的市场条件。在低波动期，它将流动性集中在市场价格附近，以提高资本效率。相反，在高波动期间，它更广泛地分配流动性，以减少对暂时性损失的暴露。

一个显著的例子是 [**Kyber DMM**](https://kyber.network/)，它根据市场条件调整费用参数。这使得 LP 在波动期间获得更高的费用，而交易者在市场稳定时则享受更低的费用。

Kyber 实施了 **动态费用** 模型，根据每个池的链上交易量测量市场波动。费用调整机制基于池的交易量，比较短期和长期交易量，使用简单移动平均 (SMA) 或指数移动平均 (EMA)。

计算在出售资产 X（Δx）时获得的资产 Y（Δy）数量的核心函数是：Δy = f(x) - f(x + Δx · (1 - fee - z))，其中 xx 和 yy 是资产 X 和 Y 的当前库存，fee 是 AMM 预定义的基本费用，zz 是基于平均交易量的变动因子，满足：-fee ≤ zz < 1 - fee。

**Kyber 模型的其他一些关键方面包括：**

*   **流动性聚合和路由：** 为了解决流动性碎片化问题，Kyber 从多个 DEX 中汇聚资源，减少滑点，确保交易者通过最有效的流动性路径获得最有利的汇率。
*   **LP 的可定制资本分配：** 该平台使 LP 能够指定希望分配资本的价格范围，增强市场深度，最小化价格影响，并优化交易执行。
*   **实时链上价格服务：** 与传统定价服务不同，Kyber 的链上价格服务提供基于实时、网络特定流动性的价格，确保价格数据反映实际交易条件并可立即执行。

[Meteora](https://www.meteora.ag/) 是一个在 Solana 上的 DLM 模型，通过引入动态费用和离散零滑点价格区间，增强了流动性提供，优化了流动性的集中和交易方式。

该协议将流动性分段为离散区间，每个区间与特定价格范围相关联。在这些区间内，流动性用于在预定义价格进行交换，在同一区间内交易时消除滑点。该模型不同于传统的 AMM，如 Uniswap，它在连续价格曲线上分配流动性，导致可变滑点。

与 Kyber 类似，Meteora 实施了一个 **动态费用模型**，对市场波动做出响应，波动通过流动性区间的价格变动来衡量。总交换费用结合了基本费用和可变费用。基本费用为 fb = B * s，其中 BB 是基本因子，ss 是区间步长。可变费用计算为 fv(k) = A * (v_a(k) * s)^2，其中 AA 是控制参数，va(k) 是波动性累加器。该累加器使用波动性参考、指数参考和区间交叉跟踪最近的市场活动。该系统根据交易频率调整费用，使用过滤和衰减周期动态响应市场条件。

**用户和项目团队的战略利益：**

*   **LP：** 创建精确流动性“形状”的能力使 LP 能够根据其交易策略和市场需求量身定制流动性，潜在地最大化其收益，同时最小化风险。
*   **项目团队：** DLMM 为代币发行提供了新颖的方法，例如奖励早期采用者的绑定曲线和创建有机价格发现机制。此外，DLMM 模型的灵活性允许创新的代币经济学和流动性策略。

> 注意，DAMM 和 dAMM 并不相同。这里的 DAMM 是指动态自动化做市商，而分布式自动化做市商（dAMM）则是另一种概念。后者有一篇单独的文章。分布式 AMM（dAMM）是由 L2 技术驱动的 AMM，能够在 L2 上桥接流动性，同时在 L1 上保持不分散。请在这里查看：[https://threesigma.xyz/blog/damm](https://threesigma.xyz/blog/damm)

#### 主动做市商 (PMM)

**主动 AMM** 旨在预测市场变化，并在变化发生之前调整参数。

它们使用预测模型、历史数据和外部价格信息来预先调整参数。例如，PMM 可能会分析特定市场事件期间的过去交易量，以预测流动性需求。

虽然这种方法可能会减少无常损失并提高资本效率，但在波动的加密市场中，准确预测仍然具有挑战性。PMM 仍处于实验阶段，生产环境中的实现较少，因此与已建立的动态模型相比，其长期有效性尚未得到验证。

PMM 允许单边流动性提供，通过使用外部价格预言机进行市场对齐定价，从而简化了提供者的投资组合管理。通过对基础资产和报价资产进行分段池管理，其算法优化了绑定曲线，并根据市场条件重新平衡资产比例。动态费用根据波动性进行调整，而可定制的流动性深度允许在价格范围内进行微调。

[DODO](https://dodoex.io/) 也旨在增加其协议上的流动性，使用一种模仿传统中央限价订单簿的人类做市行为的 PMM。

PMM 算法集成了外部价格预言机，以获取资产的当前市场中间价格。然后，它根据这些外部价格调整池内的价格，使用以下定价公式：P\=i(1−k+k(B0B)2)P = i \\left( 1 - k + k \\left( \\frac{B\_0}{B} \\right)^2 \\right)

DODO 的 PMM 算法根据池的库存变化调整资产价格，以模仿专业做市商的行为。当某个资产的库存低于其目标水平 (B<B0)(B<B\_0)，表明交易者正在购买该资产时，PMM 会提高价格 PP，以抑制进一步购买并鼓励出售，从而旨在恢复库存平衡。相反，当库存超过目标 (B\>B0)(B>B\_0)，表明交易者正在出售该资产时，PMM 会降低价格 PP，以鼓励购买并减少过剩库存。

滑点系数 KK 控制价格相对于库存变化的敏感性。较小的 KK 值会将流动性集中在市场价格附近，从而降低交易的滑点。当 k\=1k=1 时，PMM 公式类似于传统 AMM（如 Uniswap）中使用的 CPMM 公式。

在其 PMM 算法的基础上，**DODO V3** 引入了几项技术创新：

*   **双重流动性结构：** DODO V3 实施了一个由 **Vault** 和 **Pool** 组成的双重流动性模型：
    *   **Vault（流动性提供者 - LPs）：** LPs 将资产存入 Vault，Vault 作为一个借贷池。这些资产可供策略提供者（SPs）借用。LPs 在其存款上赚取利息，利率根据资产利用率动态调整。
    *   **Pool（策略提供者 - SPs）：** SPs 管理自己的池，从 Vault 借用资产以实施做市策略。借入的资产在池内提供流动性。SPs 可以随时存入或提取自己的资产，但必须遵守抵押要求。
*   **灵活的杠杆和抵押管理：** SPs 可以通过借入超出其初始资本的资产来进行杠杆做市：
    *   **借款机制：** SPs 从 Vault 借入资产，以增强其池中的流动性。借入的资金保留在池内，不能外部提取。
    *   **抵押比率：** DODO V3 监控两个关键的抵押比率以管理风险：常规抵押比率和借款抵押比率。
*   **动态利率：** 利率是资产特定的，并根据借款需求动态调整：
    *   **利息计算：** 借入资产的利息在存款、取款、借款和还款操作期间累积并复利。
    *   **利率调整：** 随着某个资产的借款比率增加（借入的资产越多），该资产的利率上升。这激励还款，并在 Vault 内平衡供需。

#### 自动化流动性管理器 (ALMs)

ALM 协议是使用复杂算法动态管理 AMM（如 Uniswap v3）上集中流动性头寸的工具。ALM 的主要目标是优化流动性的位置，以与最活跃的交易区间相吻合，从而通过增加费用收集最大化潜在回报，提高资本效率，并最小化与 LP 相关的风险。

**ALM 的核心功能：**

*   **动态范围调整：** ALM 根据市场条件调整流动性范围，确保在波动市场中有效部署资本。然而，由于高 gas 费用，重新平衡可能会很昂贵，尤其是当头寸超出活跃交易范围时，LPs 需要等待或承担重新定位成本。
*   **风险缓解：** ALM 通过根据市场价格变化重新校准流动性头寸，帮助减少无常损失，保护 LPs 在集中流动性环境中的重大损失。
*   **算法策略实施：** ALM 使用基于市场数据的算法策略来优化流动性位置，尽管这些策略可能资源密集。通过预言机进行的链外管理可以降低成本，而被动策略（如 stETH-ETH 交易对）则提供了低干预的成本效益费用收入。

[Arrakis](https://www.arrakis.finance/) PALM（协议自动化流动性管理）是一种流动性引导机制，旨在为 Uniswap V3 上的代币创建深度流动性。基于 Arrakis V2，PALM 使协议能够通过利用有机交易量来管理其代币流动性，而不是依赖流动性挖掘或绑定。

PALM 允许协议以不平衡的比例（例如，95% 治理代币和 5% 基础资产）播种初始流动性，并通过战略性地放置 Uniswap V3 头寸逐步调整至平衡的 50:50 比例。PALM 不直接交换资产；相反，它根据市场波动调整流动性头寸，确保最小的价格影响，并避免流动性挖掘或绑定中出现的负面影响。此外，这种动态管理流动性头寸不仅保持了所需的库存组成，还为协议生成了交易费用。  
下面我们可以看到以太坊上的 GEL/WETH 池，尽管最开始是 95% GEL 和 5% ETH，PALM 重新平衡至 60/40。

![](https://img.learnblockchain.cn/attachments/migrate/1731308094130)

此外，这种动态管理流动性头寸不仅保持了所需的库存组成，还为协议生成了交易费用。

*   **市场做市：** PALM 通过根据价格波动动态管理流动性，移动流动性头寸，而不产生价格影响。
*   **库存管理：** 随着价格波动，PALM 从 LP 头寸中捕获基础资产或治理代币，保持所需的库存组成，以支持持续的交易量。

这一机制对于需要深度、可持续流动性的协议尤其有用，能够为其治理代币提供支持，而无需出售代币或承担租赁流动性相关的成本。

[**Gamma**](https://www.gamma.xyz/) 是另一个 ALM，服务于许多网络上的各种 DEX（包括 Uniswap）。

动态范围和稳定策略专门旨在减少无常损失，同时最大化 LP 的费用收入。Gamma 的策略大多被认为是基于范围的，但可以说，过于狭窄的范围需要频繁的再平衡，这将涉及一些资本效率最大化策略的元素：

*   **动态范围策略 -** 这些策略涉及在某些触发条件（例如价格波动）达到时自动再平衡流动性范围。它们也有两种类型：狭窄和宽广。顾名思义，它们表示提供的流动性范围。狭窄范围适合风险承受能力较高的 LP，提供更多的费用，但在波动期间更容易受到无常损失（IL）的影响。相反，宽广范围则面向风险承受能力较低的 LP，在波动期间最小化 IL，但收益的费用相对较低。累积的费用定期复利回到头寸中，使 LP 体验更加被动。
*   **稳定策略 -** 类似于动态范围，但专为稳定币对量身定制。与标准的动态范围策略不同，流动性范围基于历史数据，而不是动态调整以适应实时价格波动。

#### 复制市场做市商（RMMs）

**RMMs** 起源于 2021 年，出现在 [这篇论文](https://arxiv.org/pdf/2103.14769) 中，由 Angeris、Tarun 和 Alex Evans 提出，复制了传统金融工具（如期权）在 **CFMMs** 框架内，创建了复杂金融衍生品与区块链系统之间的桥。

RMMs 的核心思想是将 CFMM 的 **投资组合价值函数**（代表流动性提供者持有的价值）与特定的、期望的支付结构对齐。该支付结构可以是：

*   **凹的**：反映输入增加时收益递减。
*   **非负的**：确保支付永远不会为负。
*   **非递减的**：保证支付不会随着输入的增加而减少。
*   **1-齐次的**：意味着支付与输入的大小成比例地缩放。

RMMs 利用期望支付函数空间与凸 CFMMs 之间的等价性，使用凸分析中的 Fenchel 对偶性来实际构建这些市场做市商。它们可以使用凸分析中的简单工具构建，使开发者能够将复杂的金融工具集成到 DeFi 项目中。

由于几个关键因素，RMMs 在 AMM 领域难以获得 traction。首先，RMMs 依赖于需要更多计算能力的金融模型，导致更高的 gas 费用，这可能会使交易者和流动性提供者望而却步。其次，RMMs 将流动性分散到更多专业化的池中，降低了它们的整体影响，除非用户采用显著增加。最后，RMMs 针对期权和衍生品等小众金融产品，吸引的用户基础相较于用于常规交易对的简单 AMM 更小。

* * *

### 2022-2024» - 优化时代

从 2022 年起，AMM 已经稳固地建立了有效的模型，获得了显著的 traction，并具备了能够解决许多过去挑战的基础设施。尽管 **无常损失** 和 **延迟脆弱性风险（LVR）** 等问题依然存在，但由于设计和风险管理策略的改进，这些问题在大多数协议中变得不那么明显。

因此，社区的关注点转向优化 AMM 的核心机制，旨在提高资本效率，减少摩擦，并提供更无缝的用户体验。这一时期标志着从单纯克服基础障碍到在既定框架内进行微调和创新的转变，推动 AMM 生态系统进入一个新的复杂性和成熟度的时代。

![](https://img.learnblockchain.cn/attachments/migrate/1731308094135)

### 2022 年升级

#### Trader Joe

[**Trader Joe**](https://lfj.gg/avalanche/) 引入了一种名为流动性书的设计，结合了 CSMM 模型的元素。与传统的 CSMM 不同，后者容易受到套利和流动性枯竭的影响，Trader Joe 的实现使用离散化的箱体结构来减轻这些风险，同时仍然利用特定价格范围内零滑点交易的好处。在流动性书的每个箱体内，该模型表现得像一个 CSMM，在狭窄的价格范围内提供恒定和动态。

例如，考虑一个 ETH/USDC 池，具有两个相邻的箱体：

1.  箱体 A：ETH 价格在 1000.00 和 1010.00 USDC 之间
2.  箱体 B：ETH 价格在 1010.00 和 1020.00 USDC 之间

每个箱体都充当自己的迷你 CSMM 池。只要交易完全发生在箱体 A 或箱体 B 内，就会以零滑点执行。这是因为在每个箱体内，价格是固定的，资产的比例仅沿着恒定和动态线移动。

![](https://img.learnblockchain.cn/attachments/migrate/1731308094162)

#### VE (3,3) AMM

在 2022 年 1 月，**Solidly** 被引入，旨在通过整合 Uniswap 和 Curve 等协议的特性来增强 AMM 机制。

虽然其 AMM 设计并不突破，但 Solidly 的关键创新在于其代币经济学——特别是 ve(3,3) 模型的引入。该模型将 Curve 的投票托管代币机制（veCRV）与 OlympusDAO 的博弈论（3,3）质押激励结合起来，旨在将用户参与与长期协议健康对齐。

尽管其创新方法面临技术漏洞和代币发行问题等挑战，影响了其可行性，但其基础概念激励了其他项目对其原则进行改进和完善。基于 Solidly 思路构建的协议的显著例子包括 Thena、Velocore、Base 网络上的 Aerodrome 和 Velocimeter。

#### 关键技术创新

*   **混合 AMM 设计：** 这些平台结合了 Uniswap 的集中流动性和 Curve 的稳定交换模型的元素。这种混合方法使它们能够提供稳定和波动的池，满足不同资产类型和市场条件的需求。
*   **具有动态费用的集中流动性：** 利用 Algebra 的技术，使流动性提供者能够在特定价格范围内分配资本。动态费用结构根据市场波动进行调整，提高资本效率并减少滑点。
*   **先进的流动性管理：** 这些协议结合了根据市场波动自动调整流动性头寸的算法。这种动态管理增强了价格发现，最小化了无常损失。

#### 池类型和特性

*   **稳定池**：利用修改后的稳定交换公式，适用于价格波动较小的资产，如稳定币，确保低滑点和高效交换。
*   **波动池**：专为价格波动较大的资产设计，这些池允许自适应再平衡，并在更波动的市场中进行高效交易。
*   **动态池（Thena 的 FUSION）**：专门为价格锚点不断变化的资产量身定制，如流动质押衍生品，提供流动性提供的灵活性。

#### 激励机制

*   **排放**：通过优化的排放计划和使用工具如计量投票和激励，这些协议更有效地将激励与流动性提供者对齐，促进更可持续的流动性。
*   **反稀释措施**：增强机制保护参与者奖励的价值，支持长期参与并促进生态系统的稳定。

![](https://img.learnblockchain.cn/attachments/migrate/1731308094210)

### 2023 年升级

#### Ambient Finance

曾被称为 Crocswap，**Ambient**是一个 AMM，集成了多种形式的 AMM——包括集中流动性、CPMMs 和淘汰流动性——到单一流动性池中。其单合约设计也显著降低了交易和流动性提供管理的 gas 成本。

Ambient Finance 使用无许可和有许可的池。无许可池允许任何代币对的用户操作不受限制，而有许可池通过预设的预言机控制访问。池类型使用 256 位值，支持广泛的自定义。

**Ambient 的关键特性：**

*   **双重流动性模型**：该平台支持集中和环境（全范围）流动性模型。流动性提供者可以指定价格范围来分配其资本。全范围流动性模型使费用自动复利回到池中。
*   **淘汰流动性**：淘汰流动性是一种基于范围的集中流动性的特殊形式。当价格越过指定范围边界时，它会被永久移除，无论是低于底部（买入）还是高于顶部（卖出）。与传统集中流动性不同，一旦触发，它不会恢复，有效地锁定了该位置。该机制类似于限价单，但关键区别在于它在固定范围内操作，而不是在单一价格点。
*   **动态费用结构**：与本节中的大多数 AMM 一样，Ambient 也实施动态流动性费用。政策预言机监控 Uniswap v3 费用层的表现，并每 60 分钟更新 Ambient 的费用结构。此调整在不更改基础智能合约的情况下进行，动态切换池费用以反映表现最佳的流动性层。根据他们的计算，动态费用模型对流动性提供者来说比在 30bps 或 100bps 池中提供流动性要盈利得多。而在 5bps 池中提供流动性则会导致流动性提供者亏损。来源 [这里](https://crocswap.medium.com/constructing-multivariate-models-to-improve-a-eth-usdc-dynamic-fee-policy-5d8318f4ede6)。

![](https://img.learnblockchain.cn/attachments/migrate/1731308094543)

*   **网格改进和刻度调整**：该平台具有网格改进机制，当范围订单跨越由协议治理确定的阈值时，增强刻度粒度。
*   **交易费用再分配**：从交易中收取的费用按比例再分配给流动性提供者，激励持续提供流动性并补偿他们的市场风险。

#### Maverick AMM

**Maverick AMM**引入了一种基于范围的 AMM 模型，旨在通过自动调整流动性头寸以保持接近市场价格来提高资本效率。该系统允许流动性提供者进行战略性、方向性的价格变动押注，同时赚取费用。

Maverick 通过在选定价格范围内集中流动性，提高交易效率，减少滑点，并优化交易执行。通过可定制的流动性移动模式，流动性提供者可以精确管理其流动性如何根据市场波动进行调整，根据风险偏好和市场行为量身定制其策略。

**Maverick v2 的进展**：在前身的坚实基础上，Maverick v2 引入了旨在进一步完善功能和用户体验的改进和新特性：

*   **降低交换的 gas 成本**：Maverick v2 大幅降低了与交换相关的 gas 费用。
*   **可编程池**：此功能允许创建具有自定义逻辑的专用池，如 KYC 合规或动态费用调整，以满足特定需求。
*   **方向性交换费用**：流动性提供者现在可以根据交换的方向设置不同的费用结构。
*   **增强头寸激励**：通过引入投票托管代币投票，Maverick v2 使流动性提供者能够更紧密地将激励与其在生态系统中的参与和投资对齐。

![](https://img.learnblockchain.cn/attachments/migrate/1731308094728)

#### PoolShark

Poolshark 提供灵活性并通过先进的流动性管理工具提高资本效率，使交易者和流动性提供者在波动市场中拥有更大的控制权。他们使用 3 种类型的池：

1.  **范围池**：这些池的功能类似于集中流动性模型，如 Uniswap V3 中的模型。流动性提供者为其资产选择特定的价格范围。该模型使提供者能够在特定价格范围内集中流动性。
2.  **限价池**：限价池提供了一种独特的方式在链上下限价单。它们将买入和卖出订单分开，为每个方向聚合最佳价格的流动性。这使得交易者能够以低于市场价格的方式执行更大规模的交易。
3.  **覆盖池**：这些池通过允许流动性在一系列价格中解锁，帮助用户对冲波动性和无常损失。使用渐进式荷兰拍卖（GDA）机制，覆盖池动态调整价格，确保流动性可以在最佳价格下买入或卖出，即使在波动的市场条件下。

AMM 会随着价格变化自动再平衡流动性，例如，在 ETH/USDC 池中，当 ETH 价格上涨时，它会购买更多 ETH，从而减少其 USDC 储备。这引发了路径依赖的担忧——即当用户稍后想要出售 ETH 时，AMM 可能缺乏足够的流动性（例如 USDC）。此外，AMM 可能会对暂时的价格波动过度反应。

### 2024 年及以后的升级

#### 意图

意图在加密货币之外并不是一个新概念。意图代表用户的期望结果，允许解决者（或填充者）确定实现该结果的最佳步骤。例如，将 1 ETH 交换为至少 2500 USDC。如果解决者找到更好的汇率，他们可以以 2500 USDC 完成交换，保留或与用户分享任何盈余。

尽管意图并不与任何特定协议相关或专属于 AMM，但它们的出现标志着架构的转变。意图基础协议的兴起值得注意。

一个广泛的观点是，意图将主导像 USDC、USDT、ETH 和 BTC 这样的主要资产的订单流。与此同时，AMM 上的流动性提供者可能会发现自己只在交易意图平台上交易不太受欢迎的长尾资产。

像 Uniswap-X、CowSwap 和 1Inch 这样的协议正在逐渐获得关注。例如，根据 [Orderflow.art](http://orderflow.art/?isOrderflow=true&frontend=Uniswap+Website+%26+Wallet%3A+Default&frontend=Uniswap+Website%3A+Uniswap+X+ON&timeframe=30d) 的数据，在过去 30 天内，通过 Uniswap 前端和钱包交易了 23 亿美元，而在 Uniswap-X 上交易了 5.87 亿美元。

![](https://img.learnblockchain.cn/attachments/migrate/1731308094805)

在这个 Dune 图表中也可以看到同样的趋势，显示出自 2023 年下半年以来，基于意图的协议的交易量如何增加。

![](https://img.learnblockchain.cn/attachments/migrate/1731308094817)

#### Uniswap V4

Uniswap V4 带来了近年来最大的更新之一，引入了钩子作为自定义流动性池和交易策略的新方法。

钩子是外部部署的合约，在交易生命周期的特定时刻或钩子定义的战略时刻执行开发者定义的逻辑。钩子允许对集中流动性池进行自定义和添加新功能。

在 Uniswap V4 上创建池时，创建者可以指定一个钩子合约。这个钩子合约包含在执行过程中池将调用的自定义逻辑。钩子合约可以实现各种功能并修改池参数。可以使用钩子实现的一些功能示例包括：分阶段执行大额订单、为交易者实施链上限价单、引入波动性转移动态费用和内部化流动性提供者的 MEV，以及实施自定义预言机解决方案。

Uniswap V4 支持多个钩子回调，钩子合约的地址决定了哪些回调被执行。当前版本的 Uniswap V4 支持八个钩子回调，这些回调在池的生命周期的不同阶段被执行：

1.  `beforeInitialize`/`afterInitialize`：这些钩子在池初始化之前和之后被调用，允许在池创建过程中执行自定义逻辑。
2.  `beforeModifyPosition`/`afterModifyPosition`：这些钩子在修改池内位置之前和之后被调用，提供在更改位置参数时添加自定义逻辑的机会。
3.  `beforeSwap`/`afterSwap`：这些钩子在池内执行交换之前和之后被调用，使得在交换过程中执行自定义逻辑成为可能。
4.  `beforeDonate`/`afterDonate`：这些钩子在向池捐赠之前和之后被调用，提供自定义捐赠过程的能力。

通过使用钩子，开发者可以利用灵活和可定制的执行框架，扩展和增强 Uniswap V4 池的功能，超越核心协议。

V4 中的另一个重大变化是引入了单例合约模型，也称为统一流动性。与之前版本使用工厂模型为每个交易对创建新池合约不同，V4 在一个合约中管理所有池。

单例模型显著降低了池创建和多跳交易的成本，使整个用户群体更易于访问。它还允许在所有池之间更好地管理流动性。

![](https://img.learnblockchain.cn/attachments/migrate/1731308094948)

![](https://img.learnblockchain.cn/attachments/migrate/1731308094981)

#### Uniswap X

UniswapX 是 Uniswap 引入的新协议，它扩展了其功能，而不是作为 V1、V2、V3 或 V4 的直接升级。它通过基于荷兰拍卖的去中心化交易机制提供了几个独特的功能，使其与早期版本区分开来。

UniswapX 通过一个结构化的过程运作，首先是 **订单发起和签名**，在此过程中，交换者请求并选择填充者的报价，然后用特定参数签署订单。接下来，在 **订单履行和调整** 阶段，选定的填充者履行订单或将其调整为下一个最佳报价。订单价格会根据预定义的衰减函数随时间更新。最后，在 **执行和价格改善** 阶段，填充者可能会在有利可图的情况下履行订单，这可能会改善交换者的价格。Uniswap X 的主要特点包括：

*   **基于荷兰拍卖的交易系统**：该设计采用荷兰拍卖机制，订单价格随时间下降，创造了填充者之间的竞争环境——执行订单的代理，以确保为交换者获得最佳价格。
*   **流动性聚合和免 gas 交换**：该系统从链上和链下来源聚合流动性，从而提高执行质量。它引入了免 gas 交换，填充者承担 gas 成本，这些成本被纳入执行价格。此外，它支持跨链交换，使得在一次操作中跨不同区块链进行交易成为可能。
*   **MEV 内部化**：该平台内部化 MEV，将任何盈余作为价格改善返还给交换者。
*   **无额外费用和流动性费用飞轮**：这不会在填充者利润和可选协议费用之外施加额外费用。成功由“流动性费用飞轮”驱动：高流动性吸引交易者，产生费用，吸引更多流动性提供者，形成自我强化的循环。

![](https://img.learnblockchain.cn/attachments/migrate/1731308095236)

#### 功能最大化做市商 (fm-AMM)

**FM-AMMs** 设计的核心假设是交易在执行之前被批量处理。通过利用套利者之间的竞争，FM-AMMs 有效消除了套利利润、LVR 和夹击攻击。在 FM-AMM 上，给定交易 x 执行的价格等于交易执行后的边际价格。这意味着 FM-AMM 在每次交易时“向上”移动曲线。

![](https://img.learnblockchain.cn/attachments/migrate/1731308095646)

在实际应用中，FM-AMMs 已经在 [11 个代币对上使用币安价格数据进行评估，以模拟流动性提供者的下限回报](https://arxiv.org/pdf/2307.02074)。研究结果表明，向 FM-AMM 提供流动性的下限回报通常略高于在 Uniswap v3 上观察到的经验回报，而 Uniswap v3 仍然是主导的 AMM 平台。

**CoW Swap** 和 **Sorella Labs** 在推动 FM-AMMs 的前沿。

[**CoW Swap**](https://swap.cow.fi/)，即“需求的巧合”，通过优先考虑直接的 P2P 交易并在 P2P 不可行时利用求解器，区别于其他 DEX。这种混合方法不仅降低了 gas 成本和流动性提供者费用，还减少了 MEV 攻击的潜在风险，这在其他 DEX 格式中是常见的漏洞。CoW Swap 的 FM-AMM 框架将交易批量处理，然后以统一的清算价格执行，确保每笔交易“向上移动曲线”，以保持价格的准确性和公平性。

CoW Swap 的 AMM 的新颖之处在于其管理交易执行的方式：

*   **求解器竞争**：CoW 生态系统中的求解器竞争以找到最优的交易执行方式，从而确保流动性池始终在均衡价格下运作。
*   **批量拍卖**：通过将交易批量处理，CoW AMM 减少了通常利用价格差异的套利风险，从而保护流动性提供者的利益。

[**Sorella Labs**](https://sorellalabs.xyz/) 以类似的理念运作，专注于创建解决方案，以使交易在同一块内共享相同的执行价格。这种方法被称为“批量拍卖”，通过消除无风险利润的机会，显著减少了套利者的优势，Sorella Labs 的 Ludwig Thouvenin 认为在一个良好运作的市场中不应存在这种优势。

**共同点与独特方法**

CoW Swap 和 Sorella Labs 都利用 FM-AMM 框架来提高代币交换的效率，并保护流动性提供者免受之前 AMM 设计的缺陷。然而，它们对 FM-AMM 概念的应用在具体机制和目标上有所不同：

*   **CoW Swap** 旨在通过在求解器之间使用竞争模型来优化交易执行，从而确保流动性提供者从与 AMM 执行的交易中获得最佳结果。
*   **Sorella Labs** 则更专注于重新定义交易的批量处理和定价，以创建一个更公平的交易环境，直接解决当前 DEX 中普遍存在的 MEV 问题。

#### 自动化流动性管理 AMMs (am-AMMs)

[**am-AMMs**](https://arxiv.org/abs/2403.03367) 通过进行抗审查的链上拍卖来任命一个临时池管理者，以管理一个恒定产品 AMM。池管理者设定交换费用率并接收交易产生的费用。此外，管理者可以进行套利，以使池价格与市场保持一致，并根据零售订单流和市场条件的变化调整费用，从而增强流动性提供者的收益。

流动性提供者可以自由进出池，但需支付少量的取款费用。在某些条件下，am-AMMs 预计将实现比标准固定费用 AMM 更高的流动性均衡。然而，协议仍需实施 am-AMMs。

#### Valantis

Valantis 旨在通过算法流动性模块 (ALMs) 实现灵活的代币交换，不要将其与自动化流动性管理器 (ALMs) 混淆。

Valantis 具有两种不同的池类型：主权池，允许自定义定价；和通用池，旨在减少流动性碎片化。

混合订单类型 (HOT) 通过结合两种执行模式：无许可 AMM 和请求报价 (RFQ) 系统，为 Valantis 引入了独特的功能。该设计通过动态的、基于时间的费用结构来最小化流动性风险并优化定价。

HOT 通过提供稳定和具有竞争力的定价来增强流动性，同时保护流动性提供者免受市场波动和套利带来的损失。该系统还支持重置代币，并通过在交易后重置现货价格来减少区块顶部套利。

目前，HOT 签名者是由 Valantis Labs 和合作流动性管理者（如 Arrakis）运营的集中组件。在过去两个月中，它的交易量约为 1200 万美元，TVL 为 41.5 万美元。

![](https://img.learnblockchain.cn/attachments/migrate/1731308095770)

VAL 代币治理该协议，使用户能够影响关键更新和激励措施。

## 结论

AMM 的演变是变革性的，提供了技术进步、新的用例和持续塑造 DeFi 的挑战。

通过本文，我们考察了设计领域的关键创新，重点关注 CPMMs、CSMMs 和混合及动态 AMM 等模型。这些方法各自提供了开发者在设计 AMM 时必须考虑的特定权衡。

**资本效率与流动性管理**

集中流动性模型的发展，如 Uniswap V3 和 Curve 等混合系统，反映了最大化资本效率的趋势。

然而，这些改进以流动性管理的复杂性增加为代价。开发者必须权衡更高回报的好处与暂时性损失的风险以及对流动性提供者更积极参与的需求。

**价格发现与市场整合**

AMM 协议通过内部流动性（仅依赖流动性池比例）或通过 RFQ、做市商等整合外部市场数据来处理价格发现。

内部机制，如 CPMMs，虽然“简单明了”，但在市场波动期间可能会面临滑点和定价效率低下的问题。像 DAMMs 这样的混合模型通过动态调整费用和流动性以响应外部市场信号，提供了更灵活的定价，但这需要额外的基础设施，并增加了流动性提供者的复杂性和风险。开发者必须考虑离线数据对其协议的重要性，并在外部整合的成本和安全风险之间取得平衡。

**减轻暂时性损失 (IL)**

暂时性损失仍然是流动性提供者在 AMM 上面临的重大挑战，尤其是在集中流动性 AMM 上。像 Bancor（现已弃用）的 IL 保护功能可以在一段时间内有效，但最终会崩溃。

Curve 的动态挂钩模型试图减轻这一风险，但并非万无一失。例如，在稳定币脱钩的情况下，随着池的流动性耗尽，定价曲线变得越来越平坦，导致两端出现剧烈波动，结果是库存失衡。这可能导致在这些时期进入或退出池的流动性提供者遭受暂时性损失。

随着 AMM 设计变得越来越复杂，在不使用户体验过于复杂或增加 gas 费用的情况下管理 IL 成为一个核心挑战。能够在效率和用户保护之间进行优化的协议可能会获得更大的采用。

**用户体验与技术复杂性：**

AMM 模型的复杂性与其对非专业用户的可及性之间存在日益加大的鸿沟。

早期模型几乎允许任何人成为流动性提供者。后来，集中流动性或意图的引入使这一过程变得更加困难。当然，任何人仍然可以在 Uniswap V3 上提供流动性，但有多少人能够盈利？

AMM 的未来可能取决于它们在提供复杂的流动性管理工具的同时，保持无缝和直观的用户体验的能力。开发者面临艰难的选择，是吸引专业做市商和其他专业参与者（他们实际上全天候进行市场交易），还是努力减少非技术用户的交互摩擦。

**未来展望与主流采用：**

尽管开发者的兴趣日益增长，并且引入了更复杂的 AMM，如混合 CFMM、DAMM 和 PMM，但 DeFi 的交易量仍然仅占整体加密货币交易量的一小部分，甚至在全球金融体系中也占据更小的比例。为了让 DeFi 创造新的经济范式，它必须克服这一采用障碍。

![](https://img.learnblockchain.cn/attachments/migrate/1731308095779)

![](https://img.learnblockchain.cn/attachments/migrate/1731308095860)

新协议针对诸如无常损失、无常损失、MEV、资本效率和滑点等问题。然而，它们往往增加了生态系统的复杂性，回到了自 DeFi 诞生以来一直困扰它的问题。

联系 Three Sigma，让我们经验丰富的专业团队自信地引导你穿越 Web3 领域。凭借我们在智能合约安全、经济建模和区块链工程方面的专业知识，我们将帮助你确保项目的未来。

[今天联系我们](https://threesigma.xyz/contacts)，将你的 Web3 愿景变为现实！

## 参考文献

*   [https://medium.com/bollinger-investment-group/constant-function-market-makers-defis-zero-to-one-innovation-968f77022159](https://medium.com/bollinger-investment-group/constant-function-market-makers-defis-zero-to-one-innovation-968f77022159)
*   [https://www.blog.goosefx.io/world-of-defi-types-of-amms/](https://www.blog.goosefx.io/world-of-defi-types-of-amms/)
*   [https://medium.com/@VendingMachine/amm-incentivization-velodrome-and-aerodrome-3a2e76afb515](https://medium.com/@VendingMachine/amm-incentivization-velodrome-and-aerodrome-3a2e76afb515)
*   [https://www.gauntlet.xyz/resources/uniswap-alm-analysis](https://www.gauntlet.xyz/resources/uniswap-alm-analysis)
*   [https://collectiveshift.io/defi/amm-guide/#:~:text=A brief history of AMMs,)%3A Private automated liquidity pools](https://collectiveshift.io/defi/amm-guide/#:~:text=A%20brief%20history%20of%20AMMs,\)%3A%20Private%20automated%20liquidity%20pools)
*   [https://www.defipulse.com/blog/amms-derivatives-markets-history](https://www.defipulse.com/blog/amms-derivatives-markets-history)
*   [https://bennyattar.substack.com/p/the-evolution-of-amms](https://bennyattar.substack.com/p/the-evolution-of-amms)
*   [https://collectiveshift.io/defi/amm-guide/#:~:text=A brief history of AMMs,)%3A Private automated liquidity pools](https://collectiveshift.io/defi/amm-guide/#:~:text=A%20brief%20history%20of%20AMMs,\)%3A%20Private%20automated%20liquidity%20pools)
*   [https://snapinnovations.com/amm-vs-order-book-understanding-the-core-of-modern-crypto-trading/#:~:text=Unlike traditional trading systems%2C AMMs,liquidity might otherwise be scarce](https://snapinnovations.com/amm-vs-order-book-understanding-the-core-of-modern-crypto-trading/#:~:text=Unlike%20traditional%20trading%20systems%2C%20AMMs,liquidity%20might%20otherwise%20be%20scarce)
*   [https://pandichef.medium.com/a-brief-history-of-uniswap-and-its-math-90443241c9b7](https://pandichef.medium.com/a-brief-history-of-uniswap-and-its-math-90443241c9b7)
*   [https://medium.com/bollinger-investment-group/constant-function-market-makers-defis-zero-to-one-innovation-968f77022159](https://medium.com/bollinger-investment-group/constant-function-market-makers-defis-zero-to-one-innovation-968f77022159)
*   [https://medium.com/diatomix-community/deep-dive-into-automated-market-maker-amm-bc667ac39780](https://medium.com/diatomix-community/deep-dive-into-automated-market-maker-amm-bc667ac39780)
*   [https://blaize.tech/article-type/amm-types-differentiations/](https://blaize.tech/article-type/amm-types-differentiations/)
*   [https://iandevendorf.medium.com/uniswap-a-closer-look-at-the-bonding-curve-62f98b2af927](https://iandevendorf.medium.com/uniswap-a-closer-look-at-the-bonding-curve-62f98b2af927)
*   [https://medium.com/@QuantAMM/looking-back-at-amms-of-2023-innovations-and-new-approaches-834d373b4f3](https://medium.com/@QuantAMM/looking-back-at-amms-of-2023-innovations-and-new-approaches-834d373b4f3)

> 我是 [AI 翻译官](https://learnblockchain.cn/people/19584)，为大家转译优秀英文文章，如有翻译不通的地方，在[这里](https://github.com/lbc-team/Pioneer/blob/master/translations/9840.md)修改，还请包涵～